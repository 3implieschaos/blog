<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>3implieschaos</title><link href="http://3implieschaos.org/" rel="alternate"></link><link href="http://3implieschaos.org/feeds/all.atom.xml" rel="self"></link><id>http://3implieschaos.org/</id><updated>2018-08-31T18:37:00-04:00</updated><entry><title>Let's Name Laws of Physics After Physics, not People</title><link href="http://3implieschaos.org/lets-name-laws-of-physics-after-physics-not-people.html" rel="alternate"></link><published>2018-08-31T18:37:00-04:00</published><updated>2018-08-31T18:37:00-04:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-08-31:lets-name-laws-of-physics-after-physics-not-people.html</id><summary type="html">&lt;h2&gt;Overview&lt;/h2&gt;
&lt;p&gt;The IAU XXX General Assembly &lt;a href="https://www.iau.org/news/pressreleases/detail/iau1810/"&gt;closed today&lt;/a&gt;
and has passed &lt;a href="https://www.iau.org/static/archives/announcements/pdf/ann18029e.pdf"&gt;Resolution B4&lt;/a&gt;
calling for renaming Hubble's Law to the Hubble-Lema&amp;icirc;tre Law. Members will electronically
vote on this resolution later this year. Here's a bigger idea:
let's stop naming laws after people.&lt;/p&gt;
&lt;h3&gt;Why the IAU XXX wishes to rename Hubble's Law&lt;/h3&gt;
&lt;p&gt;Here are their main
points, summarized in my own words:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The discovery that galaxies are flying away from us was &lt;em&gt;huge&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Belgian astronomer Georges Lema&amp;icirc;tre published this finding in 
1927 along with theoretical support before Hubble.&lt;/li&gt;
&lt;li&gt;The journal he published in wasn't too popular so his findings were not widely 
circulated.&lt;/li&gt;
&lt;li&gt;Lema&amp;icirc;tre and Hubble attended a conference together in 1928 and talked 
about this expansion, Hubble later giving no attribution to Lema&amp;icirc;tre.&lt;/li&gt;
&lt;li&gt;Hubble's 1929 paper included new data that more strongly made the 
case for expansion and in it he proposes/derives a linear distance 
relationship which is what we now think of when referring to Hubble's Law.&lt;/li&gt;
&lt;li&gt;Lema&amp;icirc;tre essentially botched his chance to get more attribution when,
at the invitation of the Royal Astronomical Society, he published an English
translation of his paper but omitted the section where he derives the rate
of expansion thinking it wasn't of interest.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;They make a very valid point, and if I had voting rights, I would vote for
this resolution. But let's, just for fun, look at a radical alternative.&lt;/p&gt;
&lt;h3&gt;Why we should stop naming new laws after people, and rename old laws after concepts&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Discoveries are never clear-cut. Who gets credit for Calculus? Newton or Leibniz? 
Special relativity is often credited exclusively to Einstein, but be careful 
doing so around the French as there is a chance they may gleefully point out that 
Poincare had all the ingredients on the table before Einstein did, except the one 
magic ingredient that Einstein added, which was to 
&lt;em&gt;believe the math over any pre-conceived notions&lt;/em&gt;. By doing so, Einstein was able to 
cook up all the ingredients properly and introduce a revolution in the way we
think about space and time.&lt;/li&gt;
&lt;li&gt;Most French who will point out Poincare's contributions
do so out of national pride, for sure--Poincare was a tremendously talented 
scientist who is one of the founders of the field of Chaos Theory, for example. 
And while you can 
&lt;a href="https://en.wikipedia.org/wiki/Relativity_priority_dispute"&gt;find some intelligent discussion&lt;/a&gt; 
about how Relativity, both Special and General, were in the air and were the payoff of
a longer thread of mathematics and physics involving many contributors, that
discussion is tainted by historic and current anti-semitism, nasty bigots
who have long sought to discredit Einstein because he was of Jewish heritage.&lt;/li&gt;
&lt;li&gt;Which goes to the bigger point. While it is perfectly healthy to have a historical
interest in science history, it is inevitably tainted with biases, nationalism, and
prejudices, and other nasty ingredients which belie the concept of science and 
mathematics as being a universal human endeavor.&lt;/li&gt;
&lt;li&gt;The mathematical and scientific endeavor is a universal endeavor, and many of
the great early discoveries are named after mostly men and a few women who were
lucky enough to be parts of society that were empowered to be a part of that 
endeavor.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We are tremendously lucky to be living in a time where the opportunities
to join the mathematical and scientific endeavor are expanding more broadly. 
We must also not forget that for quite a long time, those opportunities were
quite limited. Were in not for Haskalah and Germany's introduction
of civil liberties for Jewish citizens, Einstein would likely never had had the 
opportunity to contribute to the body of science. We can find other examples like
Einstein in India, where the British rule was softening and British scientist were
becoming open to contributions from Indian science. Both 
&lt;a href="https://www.theguardian.com/education/2005/mar/31/research.highereducation"&gt;S Chandrasekhar (Chandrasekhar limit, our understanding of black holes)&lt;/a&gt;
and his uncle
&lt;a href="https://en.wikipedia.org/wiki/C._V._Raman"&gt;C. V. Raman (Raman scattering, quantum mechanics)&lt;/a&gt;, 
went on to win a Nobel prize and have a major law or phenomenon named after them.
Without these historical openings, these phenomenons and laws would have 
very likely had European names attached to them instead. We could go on, of course,
and we haven't even started talking about the lack of opportunities afforded to 
women in science, historically.&lt;/p&gt;
&lt;p&gt;Naming laws after people also has a negative effect on public perception of science
and math. It induces a culture of hero-worship that greatly skews the public's
concept of how math and science make progress. It is an iterative endeavor, where
from time to time particularly bright minds push the state of knowledge further
a decade or so, but always building upon work that came before them. 
Einstein's
General Relativity built on the work of the mathematician Riemann, for example,
as well as the field concepts of Maxwell. Newton's work built upon Euclid's 
mathematical contributions and Galileo's physical insights. The revolutions these
two helped ignite would have happened without them, only, it would have happened a bit
later. Leibniz worked out Calculus independently of Newton, and his formalism is
superior. 
Mathematicians and physicists on continental Europe made great strides with
the superior formalism both by making Calculus rigorous 
&lt;a href="https://www.jstor.org/stable/23722354"&gt;(e.g. this discussion)&lt;/a&gt; 
and by finding superior mathematical approaches to mechanics. Some
speculate that this is the case because British scientist were 
too long to overcome their devotion to their hero Newton's formalism &lt;a href="https://www.jstor.org/stable/2974733"&gt;(see this article for 
a more nuanced view)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We are in a tremendously dangerous period in history, in some ways.
Science has become a global phenomenon for both better and worse. 
Science is a tool, as good or as evil as the intention behind it. 
We can be happy that there are scientist all over the globe working
to discover new laws that help us understand the universe, new treatments
to cancer, new ways to make our use of energy more efficient and renewable.
We can also be worried that there scientist all over the world engaged 
in research meant to find more efficient ways to kill other human beings.
As globalization distributes power centers more broadly around the world,
we should aim for the scientific endeavor to foster a sense of universalism
 and connectivity. The IAU XXX General Assembly should rename Hubble's Law
 as the Law of Cosmological Expansion. History will never forget the 
 contributions of Hubble and Lema&amp;icirc;tre (and let's not forget those of 
 &lt;a href="http://www.astronomy.com/news/2018/08/big-bang-vote-iau-debates-who-gets-credit-for-expanding-universe"&gt;Howard Robertson&lt;/a&gt;
 as well). The future, hopefully, belongs to all of us.&lt;/p&gt;</summary><category term="Physics"></category><category term="Science History"></category></entry><entry><title>Jump Start for Using Headless Python Selenium With Behave</title><link href="http://3implieschaos.org/jump-start-for-using-headless-python-selenium-with-behave.html" rel="alternate"></link><published>2018-08-26T13:21:00-04:00</published><updated>2018-08-26T13:21:00-04:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-08-26:jump-start-for-using-headless-python-selenium-with-behave.html</id><summary type="html">&lt;p&gt;Testing software can often be seen as the least enjoyable part of the
&lt;a href="https://en.wikipedia.org/wiki/Systems_development_life_cycle"&gt;systems development life cycle&lt;/a&gt;.
It is easy to see why. Developing the actual application that does the magic 
that the end user finds value in is indeed a very exciting core to the process.
And yet, what you produce could be worthless if it doesn't work for the user.&lt;/p&gt;
&lt;p&gt;So let's say you are working on an individual pet project. The fun part is 
coding it up and getting it to do something. Here, I'm going to use a simple
&lt;em&gt;Flask&lt;/em&gt; app that serves up some Wikipedia page count stats as an example.
As a developer adds layers and new features and new bells and whistles and 
pipes and extension cords to their project, things which they
haven't developed in months or years can break, and if they don't have a good testing
suite in place, they won't catch it and will serve out a degraded experience.
That's a dis-service to their users, but even to themselves, whose hard work 
has gone to waste because that piece of the project, which they might have
spent many hours working on, might as well not even exist if it doesn't work.
Worse yet, if they break their app entirely, it could take hours and hours 
of searching for a bug. &lt;/p&gt;
&lt;p&gt;If instead there is a systematic testing suite in place,
each incremental change can be subjected to a battery of tests that help ensure
that it is safe to continue to the next incremental change. This &lt;em&gt;should not&lt;/em&gt; be
the developer clicking through their app and making sure everything looks good.
There are many awesome tools in place that allow for quick automated testing.
Here, we provide a walk through to jump start a web developer on using Python
 and the selenium and behave libraries to provide a full browser test of their site.&lt;/p&gt;
&lt;h2&gt;Selenium&lt;/h2&gt;
&lt;p&gt;Selenium is a Python library that automates testing the final product of 
a webpage. Selenium integrates with various browsers and replicates
the behavior that you expect from your users, all while measuring the
response to that behavior against your expectations for how the site, when
in its optimal state, should respond. 
It is as easy to install as &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install selenium nose behave
&lt;span class="sb"&gt;````&lt;/span&gt;

Let&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;s start with a very simple example. Suppose you have webpage that
simply serves this up:

&lt;span class="sb"&gt;```&lt;/span&gt;html
&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;WikiViz&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;   
        &amp;lt;h1 &lt;span class="nv"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;example&amp;quot;&lt;/span&gt;&amp;gt;Hello World!&amp;lt;/h1&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Even if you didn't want to get fancy and set up a nice file structure and 
orchestrate your testing with tools such as &lt;code&gt;behave&lt;/code&gt; and &lt;code&gt;nose&lt;/code&gt;, you 
could simply create a very straight-forward python script that runs
the selenium testing you need to ensure that your page is serving 
the expected content.&lt;/p&gt;
&lt;p&gt;If you are running these locally on your laptop, the following 
step isn't necessary, you will just need to make sure you have
Firefox installed. Selenium works with other browsers, but 
to keep this simple at first, we will focus on Firefox.&lt;/p&gt;
&lt;h3&gt;Headless on Ubuntu (skip this if using a Mac)&lt;/h3&gt;
&lt;p&gt;Skip this section if you don't plan to run this on a remote
linux-based server. In this example, I'm using my Cloud 9 IDE 
account which serves up containers with Ubuntu as the OS.&lt;/p&gt;
&lt;p&gt;First we need to isntall the &lt;a href="https://en.wikipedia.org/wiki/Xvfb"&gt;Xvfb&lt;/a&gt; package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install firefox xvfb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and the PyVirtualDisplay python library:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install selenium nose behave PyVirtualDisplay
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, you'll need the &lt;a href="https://github.com/mozilla/geckodriver/releases"&gt;geckodriver&lt;/a&gt;
(they don't include md5sums or rsa hashes to confirm authenticity, but use github
to host and release which comes with a great deal of trust):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget https://github.com/mozilla/geckodriver/releases/download/v0.21.0/geckodriver-v0.21.0-linux64.tar.gz
tar zxvf geckodriver-v0.21.0-linux64.tar.gz
chmod a+x geckodriver
sudo mv geckodriver /usr/local/bin/
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Our first selenium assertion&lt;/h3&gt;
&lt;p&gt;Now we are ready for our first test. This test will
do two things. First, it will cause selenium to try
to access the webpage. If it can't do so, it will fail.
This means that a selenium tests automatically tells 
you whether or not your page is up and running right
out of the box. Secondly, the test will assert that
the very simple webpage example shown above is setting
the title to 'WikiViz' as it should be.&lt;/p&gt;
&lt;p&gt;If you are using the headless on your remote server,
your code will look like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/usr/bin/env python&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyvirtualdisplay&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Display&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;

&lt;span class="n"&gt;display&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;visible&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;driver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Firefox&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://localhost:8080/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;WikiViz&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are running this in a local environment, such as on 
a Mac, and you like to watch selenium open the browser and 
walk through the tests, then your code would look like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;

&lt;span class="n"&gt;base_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://localhost:8080&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;driver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Firefox&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;WikiViz&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Yes, it is that easy! OK, well, at least for the title. As
your page gets more complicated, so will your testing, but 
overall the spirit of simplicity in the selenium testing scheme 
carries over. It's the complexities of html/javascript that 
you will eventually need to worry about. But we will keep things
simple here.&lt;/p&gt;
&lt;h3&gt;Expanding the tests&lt;/h3&gt;
&lt;p&gt;In order to make our example just a little more
interesting, and give selenium something to &lt;em&gt;do&lt;/em&gt; rather than
just &lt;em&gt;observe&lt;/em&gt;, let's add a button to our simple home page 
that takes us to another page. Add the following just after
the h1 entry:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;form&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;button&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;results&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;onclick=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;window.location.href=&amp;#39;/results&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In this next section, I'm going to make the tests a little more
complicated in structure, but for a good payoff. If you like to 
keep your tests in a single script as above, you can simply expand
on that script. Here, I will show a simple example using &lt;code&gt;nose&lt;/code&gt;
and &lt;code&gt;behave&lt;/code&gt; libraries. This example was inspired by a slightly more
complicated (and well done) example (which doesn't have the headless feature)
&lt;a href="https://the-creative-tester.github.io/Python-Web-Browser-Automation-Behave/"&gt;here&lt;/a&gt;,
but meant to be easier to dive into for those new to testing with selenium.&lt;/p&gt;
&lt;p&gt;Create a file structure that looks as follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;env&lt;span class="o"&gt;)&lt;/span&gt; tdj28:~/workspace/selenium_tests &lt;span class="o"&gt;(&lt;/span&gt;master&lt;span class="o"&gt;)&lt;/span&gt; $ tree .
.
├── features
│   ├── __init__.py
│   ├── pages
│   │   └── __init__.py
│   └── steps
│       └── __init__.py
└── simple_examples
    └── xvfb_example.py
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;here's some bash to make that happen:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir -p selenium_tests/features
mkdir selenium_tests/pages
mkdir selenium_tests/steps
mkdir selenium_tests/simple_examples
touch selenium_tests/features/__init__.py
touch selenium_tests/pages/__init__.py
touch selenium_tests/steps/__init__.py
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;simple_examples&lt;/code&gt; directory is where I put in some simple scripts
for testing a few features (or writing this blog post), but you definitely
don't want something that sloppy in a production version of your code.&lt;/p&gt;
&lt;p&gt;(Google &lt;code&gt;init python files&lt;/code&gt; if you don't know what those &lt;code&gt;__init__.py&lt;/code&gt; files
are for.)&lt;/p&gt;
&lt;h3&gt;Step One: Define the Behavior&lt;/h3&gt;
&lt;p&gt;BDD development would have us define behaviors we expect of the site before
we even begin to develop site. That's a good place to start for selenium testing
as well, where if these definitions are pre-existing, we can use them as our starting
point. If not, we can easily create our own.&lt;/p&gt;
&lt;p&gt;In the &lt;code&gt;features&lt;/code&gt; directory, create a file called &lt;code&gt;clickbutton.feature&lt;/code&gt; with
the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Feature&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;ClickButton&lt;/span&gt;

  &lt;span class="n"&gt;Scenario&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Click&lt;/span&gt; &lt;span class="n"&gt;Away&lt;/span&gt; &lt;span class="n"&gt;From&lt;/span&gt; &lt;span class="n"&gt;Homepage&lt;/span&gt;
    &lt;span class="n"&gt;Given&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;navigate&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;Home&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;
    &lt;span class="n"&gt;And&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;pagename&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;WikiViz&lt;/span&gt;
    &lt;span class="n"&gt;And&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;When&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;click&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;button&lt;/span&gt;
    &lt;span class="n"&gt;Then&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;pagename&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;longer&lt;/span&gt; &lt;span class="n"&gt;WikiViz&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This is the beauty of the &lt;code&gt;behave&lt;/code&gt; library and behavior based testing in general.
We can use everyday language to describe our user's experience, and then translate
that in to tests as we will see shortly. This enables non-technical folks to
contribute tests. &lt;/p&gt;
&lt;p&gt;Note that in the above tests, the last line entry is a bit of a cheat on my part.
The test really should, in that line, confirm in some way that it made it to the 
results page. So don't do what I did there! If for example you click on the button
and it takes you to a 404 error page, your test will still pass. I take that shortcut
here only to keep this jump start example focused on a single simple html page.&lt;/p&gt;
&lt;h3&gt;Step Two: Turn the Behaviors Into Steps&lt;/h3&gt;
&lt;p&gt;In the steps folder, create a file called &lt;code&gt;clickbutton_step.py&lt;/code&gt;. Note that
it has the same prefix &lt;code&gt;clickbutton&lt;/code&gt; as the corresponding features file we
created above, that is required for each feature file. The contents of this
file will have:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;nose.tools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;assert_equal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;assert_not_equal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;assert_true&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium.webdriver.common.by&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;By&lt;/span&gt;

&lt;span class="nd"&gt;@given&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I navigate to the Home page&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;step_impl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;navigate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://localhost:8080/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@given&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I see that the pagename is WikiViz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;step_impl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;assert_equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_page_title&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;WikiViz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@given&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I see the header &amp;quot;Hello World!&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;step_impl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;assert_equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_page_header&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I click the button&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;step_impl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;click_button&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="nd"&gt;@then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I see that the pagename is no longer WikiViz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;step_impl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;assert_not_equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_page_title&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;WikiViz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So the pattern here is starting to become clear:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;User experience ---&amp;gt; Steps ---&amp;gt; Page functions
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We have chosen to create the steps before the page functions here because that is
a natural way to proceed. The steps will tell you what functions you need to create,
and then afterwards, create those functions with the narrow scope defined by
the steps.&lt;/p&gt;
&lt;h3&gt;Step Three: Turn the Steps Into Implemented Functions&lt;/h3&gt;
&lt;p&gt;Let's stick with our simple home page as detailed above. We
can look behind the curtain of this page by using our browser's 
developer console. On Chrome, for example, it is in settings &amp;gt; More Tools &amp;gt;
Developer Tools. This gives you many great tools to inspect
the code and help you locate elements in your code. For our
simple example, that isn't so necessary, but as this example
is expanded to include javascript which makes the page more dynamic,
these developer tools become very useful. In this screenshot below,
for example, we see how it helps us identify elements of the code.&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180826/devtools.png" /&gt;&lt;/p&gt;
&lt;p&gt;These elements become key as we find key elements to use in our 
testing. &lt;/p&gt;
&lt;p&gt;In the pages folder, create a file called &lt;code&gt;home_page.py&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium.webdriver.common.by&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;By&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;browser&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Browser&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HomePage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Home Page Actions&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;navigate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_page_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_page_header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_element_by_class_name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;example&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;click_button&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;locator&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_element_by_class_name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;button&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;click&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Because the source code of our simple page assigns the first and only
h1 header by giving it the class "example", that makes it easy
to &lt;code&gt;find_element_by_class_name&lt;/code&gt;. If in fact we had multiple h1 elements
with that class, we would have to use the plural &lt;code&gt;find_elements_by_class_name&lt;/code&gt;
instead, which returns a list that we could submit for testing (e.g. 
we would know what the first h1 should be, the second, etc.).&lt;/p&gt;
&lt;p&gt;So for our homepage, we have created the HomePage class, which inherits the
Browser class we created previously, and we define the actions we will 
need on this page for testing. When we add other pages to our example
web app in later blog entries, we will create a new file in the pages 
folder, one for each page. In this way, we keep the details nice and cleanly
compartmentalized. If we have a subset of pages that share much in common,
we can create a class for that subset, and then have individual pages 
inherit that class, and so on.&lt;/p&gt;
&lt;p&gt;Also note that there are multiple ways we can identify elements, including
&lt;code&gt;xpath&lt;/code&gt;. In this file, we add four tools associated with our homepage. 
The first is a navigate function, the second returns the pagename, 
the third returns the h1 element, and
the fourth clicks on the button we just added that will send us to a new page.&lt;/p&gt;
&lt;h3&gt;Step Four: Define The Browser&lt;/h3&gt;
&lt;p&gt;Before we can make use of the defined behaviors and expectations,
we need to set up our browser and display (for headless).&lt;/p&gt;
&lt;p&gt;Create the file &lt;code&gt;features/browser.py&lt;/code&gt; with the following content
if you want selenium to run on your laptop or desktop in a way
that you can watch it run through the tests:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;driver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Firefox&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;implicitly_wait&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_page_load_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;maximize_window&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here, I've made the page timeout ten seconds 
because if my page is taking longer than ten seconds to load, 
to me that is a pretty good reason for it to fail. I would actually 
recommend you being more generous than not, and instead build in timing
features to test for load time rather than have the tests timeout as
an indication that your page is slow, but again, this is meant to be 
a baseline example.&lt;/p&gt;
&lt;p&gt;For those wishing to use headless testing (on a remote server, no live
browser to watch), the above file will look like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyvirtualdisplay&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Display&lt;/span&gt;  &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BDisplay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
    &lt;span class="n"&gt;display&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;visible&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
    &lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;driver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Firefox&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;implicitly_wait&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_page_load_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;maximize_window&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Step Five: Putting it all together&lt;/h3&gt;
&lt;p&gt;Finally, we need to have an environment definition to tie everything together.
This will tell &lt;code&gt;behave&lt;/code&gt; what page classes to import and tell it what to 
do before and after the tests are ran.&lt;/p&gt;
&lt;p&gt;If the &lt;code&gt;features&lt;/code&gt; folder, create a file called &lt;code&gt;environment.py&lt;/code&gt; with the content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;selenium&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;webdriver&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;browser&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;BDisplay&lt;/span&gt; &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;browser&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Browser&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pages.home_page&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HomePage&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;before_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;display&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BDisplay&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;browser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home_page&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HomePage&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;after_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c1"&gt;# Comment this out for live browser&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In the folder above features, assuming you've installed &lt;code&gt;behave&lt;/code&gt; via pip already,
simply run &lt;code&gt;behave&lt;/code&gt;. If all goes well, we get an output that indicates the tests
ran and their pass/fail status:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;env&lt;span class="o"&gt;)&lt;/span&gt; tdj28:~/workspace/selenium_tests &lt;span class="o"&gt;(&lt;/span&gt;master&lt;span class="o"&gt;)&lt;/span&gt; $ behave
Feature: ClickButton &lt;span class="c1"&gt;# features/clickbutton.feature:1&lt;/span&gt;

  Scenario: Click Away From Homepage                  &lt;span class="c1"&gt;# features/clickbutton.feature:3&lt;/span&gt;
    Given I navigate to the Home page                 &lt;span class="c1"&gt;# features/steps/clickbutton_steps.py:4 0.112s&lt;/span&gt;
    And I see that the pagename is WikiViz            &lt;span class="c1"&gt;# features/steps/clickbutton_steps.py:8 0.005s&lt;/span&gt;
    And I see the header &lt;span class="s2"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;               &lt;span class="c1"&gt;# features/steps/clickbutton_steps.py:12 0.046s&lt;/span&gt;
    When I click the button                           &lt;span class="c1"&gt;# features/steps/clickbutton_steps.py:16 0.112s&lt;/span&gt;
    Then I see that the pagename is no longer WikiViz &lt;span class="c1"&gt;# features/steps/clickbutton_steps.py:20 0.009s&lt;/span&gt;

&lt;span class="m"&gt;1&lt;/span&gt; feature passed, &lt;span class="m"&gt;0&lt;/span&gt; failed, &lt;span class="m"&gt;0&lt;/span&gt; skipped
&lt;span class="m"&gt;1&lt;/span&gt; scenario passed, &lt;span class="m"&gt;0&lt;/span&gt; failed, &lt;span class="m"&gt;0&lt;/span&gt; skipped
&lt;span class="m"&gt;5&lt;/span&gt; steps passed, &lt;span class="m"&gt;0&lt;/span&gt; failed, &lt;span class="m"&gt;0&lt;/span&gt; skipped, &lt;span class="m"&gt;0&lt;/span&gt; undefined
Took 0m0.283s
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Find the code here&lt;/h3&gt;
&lt;p&gt;For your convenience, the selenium code is 
collected &lt;a href="https://github.com/3implieschaos/wikiviz_demo_selenium/tree/20180826"&gt;here&lt;/a&gt;.&lt;/p&gt;</summary><category term="Python"></category><category term="Testing"></category><category term="QA"></category></entry><entry><title>Jump start using PNNL's new Cividis colormap in data science to make color blind friendly heatmaps</title><link href="http://3implieschaos.org/jump-start-using-pnnls-new-cividis-colormap-in-data-science-to-make-color-blind-friendly-heatmaps.html" rel="alternate"></link><published>2018-08-19T21:45:00-04:00</published><updated>2018-08-19T21:45:00-04:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-08-19:jump-start-using-pnnls-new-cividis-colormap-in-data-science-to-make-color-blind-friendly-heatmaps.html</id><summary type="html">&lt;p&gt;Heat maps have become quite common in data science, and in science in general, and for good reason. For those who can see them, they succinctly summarize patterns in data. There are many color schemes used in the wild, with the Rainbow scheme being one of the more common ones.&lt;/p&gt;
&lt;p&gt;A group at &lt;a href="https://www.pnnl.gov/"&gt;Pacific Northwest National Lab&lt;/a&gt; has recently published a &lt;a href="https://arxiv.org/pdf/1712.01662.pdf"&gt;PLOS One article&lt;/a&gt; (hat tip &lt;a href="https://www.scientificamerican.com/article/end-of-the-rainbow-new-map-scale-is-more-readable-by-people-who-are-color-blind/"&gt;Scientific American article&lt;/a&gt;) outlining their efforts to use mathematical modeling and the science of vision to create color maps for plots such that the exact same information is conveyed to those with and without color blindness.&lt;/p&gt;
&lt;p&gt;The goal of this blogpost is to demonstrate a quick way you can utilize their results in your own graphs (if you use Python). Interested readers can follow the links above for more detail on their methodology. What follows below is enough to get you off the ground using their Cividis colormap right away. Here is a sample of the difference one can get using Cividis:&lt;/p&gt;
&lt;p&gt;&lt;img alt="before and after" src="assets/20180819/color-blind-friendly-heatmap-41643744.png" /&gt;&lt;/p&gt;
&lt;p&gt;The sample below is just a starting point. More sophisticated examples of the use of Cividis can be found in the corresponding library and the above reference article.&lt;/p&gt;
&lt;h1&gt;Installing the Library&lt;/h1&gt;
&lt;p&gt;PNNL's &lt;code&gt;cmaputil&lt;/code&gt; library can be downloaded from their &lt;a href="https://github.com/pnnl/cmaputil"&gt;github&lt;/a&gt; page or installed via &lt;code&gt;pip install cmaputil&lt;/code&gt;. However, for the use cases I'm showing here, that won't quite work. &lt;a href="https://github.com/pnnl/cmaputil/pull/3"&gt;This PR&lt;/a&gt; shows why. If that PR has been merged, or an alternative fix merged, you should be able to use the library from the source. If not, here is a quick work around:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone https://github.com/3implieschaos/cmaputil
git checkout -b patch-1
git pull
&lt;span class="nb"&gt;cd&lt;/span&gt; cmaputil
python setup.py install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Assuming that works, you can now use the camputil library to use optimized Cividis colormaps.&lt;/p&gt;
&lt;h1&gt;Using Cividis&lt;/h1&gt;
&lt;p&gt;We would start by importing the key libraries:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cmaputil&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;cmu&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cmaputil.cvdutil&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;cvu&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;scipy&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Next, add the following section to your code. It modifies
the viridis colormap that comes with matplotlib and runs
some optimizations on it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Input colormap nam&lt;/span&gt;
&lt;span class="n"&gt;cmap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;viridis&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Optimize&lt;/span&gt;
&lt;span class="n"&gt;rgb1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jab1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_rgb_jab&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# Original colormap&lt;/span&gt;
&lt;span class="n"&gt;rgb2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jab2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_rgb_jab&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cvu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_cvd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="c1"&gt;# CVD colormap&lt;/span&gt;
&lt;span class="n"&gt;jab3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_linear&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jab2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# Uniformize hue (a&amp;#39; vs. b&amp;#39;)&lt;/span&gt;
&lt;span class="c1"&gt;#print(jab3)&lt;/span&gt;
&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jab4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;correct_J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jab3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# Linearize J&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Convert back to sRGB&lt;/span&gt;
&lt;span class="n"&gt;rgb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;convert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jab4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CSPACE2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CSPACE1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rgb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Resimulate CVD in case corrections took the map outside CVD-safe space&lt;/span&gt;
&lt;span class="n"&gt;rgb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cvu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_cvd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="c1"&gt;# Resimulate CVD in case corrections took the map outside CVD-safe space&lt;/span&gt;
&lt;span class="n"&gt;rgb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cvu&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_cvd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])):&lt;/span&gt;
    &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                 &lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                 &lt;span class="n"&gt;rgb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Convert to matplotlib colormap&lt;/span&gt;
&lt;span class="n"&gt;cividis&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mpl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;LinearSegmentedColormap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, you can easily incorporate it into your matplotlib plots as in the following example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;fig&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Cividis Heatmap&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;heatmap&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cividis&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;lower&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fig&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;colorbar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Cividis Heatmap&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We can compare the rainbow version of the above plot:&lt;/p&gt;
&lt;p&gt;&lt;img alt="rainbow version" src="assets/20180819/color-blind-friendly-heatmap-5ca3f3e1.png" /&gt;&lt;/p&gt;
&lt;p&gt;with the Cividis version:&lt;/p&gt;
&lt;p&gt;&lt;img alt="civids version" src="assets/20180819/color-blind-friendly-heatmap-69d2bb6c.png" /&gt;&lt;/p&gt;
&lt;p&gt;It certainly may be a matter of preference for most folks. I find the Cividis version more appealing, for example, because although the dark reds pop to me and pinpoint "hot spots" perhaps a little more quickly, they appear to be almost detached from the rest of the heat blob. In the Cividis mapping, as in other mappings which have only two colors, the spectrum is clearer. Given that using Cividis ensures that any color blind readers will be getting the same information as I see seals the deal for me and makes Cividis my go to choice for colormaps going forward.&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Cividis is an optimized version of the viridis colormap which optimizes for both the ability to discern patterns for those with normal vision and the ability of the color blind to see the exact same thing.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cividis works in Python and they also have an R library. This quick blog note shows how to use it &lt;em&gt;right now&lt;/em&gt;, but I anticipate and hope that it will become obsolete and matplotlib will incorporate Cividis and PNNL's work on this. COMSOL Multiphysics, a finite element analysis software package, for example, will be doing so.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;You can find a standalone python script which I used to create these plots using Cividis &lt;a href="https://github.com/3implieschaos/various/blob/master/2018/20180819/heatmap.py"&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="Data Science"></category><category term="Python"></category></entry><entry><title>Exploring Wikipedia Stats with Additive Model for Seasonality Decomposition</title><link href="http://3implieschaos.org/exploring-wikipedia-stats-with-additive-model-for-seasonality-decomposition.html" rel="alternate"></link><published>2018-08-05T15:22:00-04:00</published><updated>2018-08-05T15:22:00-04:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-08-05:exploring-wikipedia-stats-with-additive-model-for-seasonality-decomposition.html</id><summary type="html">&lt;h1&gt;Exploring Wikipedia page counts via additive models for seasonality decomposition&lt;/h1&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Wikipedia, in addition to being quite valuable as a &lt;em&gt;starting&lt;/em&gt; point for many student essays (as somebody who has spent time in front of the classroom, I can't emphasize the word &lt;em&gt;starting&lt;/em&gt; enough here), can provide some sociological insight by providing page count hits. In this brief blog entry, we will explore two python-ready implementations of additive models for seasonality decomposition in the context of the following topic:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Is there any seasonality with wikipedia page hits? For this question, we will look at a few keywords which we think are quite often used by school students in researching for common essay questions (e.g. Abraham_Lincoln) and other keywords which are less likely to be commonly used by students for essays at any level, for example, the American telecommunications company Sprint.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This blog entry is posted in the form of a Jupyter Notebook so that readers can recreate the findings and pursue further questions more easily.&lt;/p&gt;
&lt;p&gt;We use two &lt;em&gt;additive model&lt;/em&gt; implementations, one from a library called &lt;a href="https://www.statsmodels.org/stable/index.html"&gt;statsmodel&lt;/a&gt; and another from a library developed by Facebook called &lt;a href="https://facebook.github.io/prophet/"&gt;prophet&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Additive models for seasonality decomposition, a quick primer&lt;/h2&gt;
&lt;p&gt;Let's begin by creating a artificial time series.&lt;/p&gt;
&lt;p&gt;Before importing pandas, numpy, etc., I want to turn off some typical warnings that we see from these libraries. This is just to keep the output looking clean for presentation purposes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;warnings&lt;/span&gt;
&lt;span class="n"&gt;warnings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filterwarnings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ignore&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;numpy.dtype size changed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;warnings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filterwarnings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ignore&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;numpy.ufunc size changed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;warnings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filterwarnings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ignore&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="ne"&gt;FutureWarning&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Next, we import all of the great Python libraries. Here, for seasonal decomposition we are using statsmodel and Facebook's Prophet.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pylab&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib&lt;/span&gt; &lt;span class="n"&gt;inline&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pylab&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;rcParams&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;seaborn&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;sns&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;statsmodels.tsa.stattools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;adfuller&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;statsmodels.tsa.seasonal&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;seasonal_decompose&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fbprophet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Prophet&lt;/span&gt;

&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;figure.figsize&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Next, let's create a fake data set. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;365&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="c1"&gt;# Two years worth of days&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cumsum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tolist&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_7_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;Our brains have pattern-matching algorithms trained over billions of years, so even though the above data set is a random walk, we may see patterns there anyway. If we run it again, those patterns will change even though we were using the exact same algorithm to generate them. This of course doesn't imply that finding patterns in data is an empty task, there is very often patterns that are legitimate. The point here is to show how the additive model works by throwing something known to be random at it. Just to show, again, how entirely random the generated dataset is, let's throw a bunch in the same graph:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;rwts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;randn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cumsum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strptime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;20160101&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;%Y&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt;%m&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;dates_generated&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;days&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
    &lt;span class="n"&gt;dtse&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Series&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dates_generated&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dtse&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;365&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="c1"&gt;# Two years worth of days&lt;/span&gt;
&lt;span class="n"&gt;rwdf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;rwdf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rwts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rwdf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;#.tolist())&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_10_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;Next, let's see what happens when we apply the statsmodel implementation of the additive model to a random walk dataset:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;additive_seasonal_plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frequency&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;I forgot to tinclude a title.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;fig&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplots&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;decompositionm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seasonal_decompose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;freq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;frequency&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;additive&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;trendm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trend&lt;/span&gt;
    &lt;span class="n"&gt;seasonalm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seasonal&lt;/span&gt;
    &lt;span class="n"&gt;residualm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resid&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;411&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Original&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;412&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trendm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Trend&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;413&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seasonalm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Seasonality&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;414&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;residualm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Residuals&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tight_layout&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;additive_seasonal_plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rwts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;frequency&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Random Walk&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_13_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;Now let's try that with Prophet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;prophet_seasonal_plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frequency&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mytitle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;I forgot to tinclude a title.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Prophet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yearly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;daily_seasonality&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;weekly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mcmc_samples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seasonality_prior_scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;mytitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_future&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_future_dataframe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;periods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_forecast&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_components&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_seasonal_plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rwts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;frequency&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mytitle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Random Walk&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_16_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_16_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_16_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;Prophet makes nicer graphs out of the box, for sure. It also has a nice way to show uncertainty. And looking at the above, you might very well believe that indeed we have found some sort of phenomenon that seems to peak in late winter and spring, and on Thursday for some reason. It would be a pretty safe bet to bet that the above trend would peak in the months following the last dataset we have, right? Wrong, of course, because as you know, this dataset was generated entirely randomly. The lesson here is not that this method for modeling seasonality and forecasting is wrong, as indeed they work exactly as they are designed to, but instead that we need to be quite careful not to so readily believe what they say. This is the giant grain of salt I'm putting on your plate before getting to the fun stuff.&lt;/p&gt;
&lt;p&gt;To make this point entirely visual, let's do the same analysis as above, but instead of just using two years worth of fake data, let's create three years, but only feed the additive model two years, and see how it does in the third year.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;df1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rwts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mask1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;20160101&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;20180101&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mask1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;mask2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;20180101&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;20190101&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mask2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;_m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Prophet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yearly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;daily_seasonality&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
             &lt;span class="n"&gt;weekly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mcmc_samples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seasonality_prior_scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_future&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_future_dataframe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;periods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_forecast&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_18_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;That looks great, that stock is about to go up like crazy, let's dump our entire life-savings into that stock!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;df3&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;matplotlib.axes._subplots.AxesSubplot at 0x7f7fbe8d1048&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_20_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Oops.&lt;/p&gt;
&lt;h2&gt;Wikipedia Page hit stats&lt;/h2&gt;
&lt;p&gt;Previously, in order to get a nice way to access Wikipedia page hit data, I would have suggsted the R library wikipediatrend. The situation has evolved such that wikipediatrend is not functional (see &lt;a href="https://github.com/petermeissner/wikipediatrend/issues/32"&gt;this link for more details&lt;/a&gt;). Fortunately, Wikimedia themselves have released an api that has a &lt;a href="https://github.com/mediawiki-utilities/python-mwviews"&gt;python library&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;mwviews.api&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;PageviewsClient&lt;/span&gt;

&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;PageviewsClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blog&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Although there is a &lt;a href="https://dumps.wikimedia.org/other/pagecounts-raw/"&gt;repository&lt;/a&gt; of old pageviews pre-dating July 2015, the API only provides dates from July 2015 forward. Let's get three years worth of data from July 2015 to July 2018. The following command outputs a dictionary with items of the form:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; datetime.datetime(2015, 12, 21, 0, 0): {&amp;#39;Lincoln&amp;#39;: 503},
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;when we make a call to extract page hit counts for the topic 'Abraham Lincoln'.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;dictLincoln&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_views&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;en.wikipedia&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Abraham Lincoln&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;granularity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;daily&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20150701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20180701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dictLincoln&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;dfLincoln&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Abraham_Lincoln&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Daily Page Counts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;Daily Page Counts&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-01&lt;/th&gt;
      &lt;td&gt;15223&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-02&lt;/th&gt;
      &lt;td&gt;15137&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-03&lt;/th&gt;
      &lt;td&gt;17291&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-04&lt;/th&gt;
      &lt;td&gt;19697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-05&lt;/th&gt;
      &lt;td&gt;18149&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;Do we see any trends just by glancing at the plot of these page hits over the three year period from July 2015 to July 2018? Initially we may see a few, such as that the page hits seem to go up after January, and have some unusual peaks in late 2016 and early 2017 (very likely, and precisely as we will see later, related to the election and inauguration of that period).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Abraham Lincoln Wiki Page Hits&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;matplotlib.axes._subplots.AxesSubplot at 0x7f7fc8603a90&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_29_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;In fact, let's plot key dates on that plot, such as the US election of 2016, inauguration of 2017, President's Day holidays, and the 4th of July. These key dates explain almost all of the spikes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Abraham Lincoln Wiki Page Hits + Key dates&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linewidth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;important_dates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-02-15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-02-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-02-19&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="s1"&gt;&amp;#39;2015-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;xc&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;important_dates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-01-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-03-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;90000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;(0, 90000)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_31_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Next we apply statsmodel's implementation of the additive model for seasonal decomposition:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;fig&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplots&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Seasonal trend for Wiki Page Counts: Abraham Lincoln&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;decompositionm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seasonal_decompose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;freq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;additive&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;trendm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trend&lt;/span&gt;
&lt;span class="n"&gt;seasonalm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seasonal&lt;/span&gt;
&lt;span class="n"&gt;residualm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resid&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;411&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Original&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;412&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trendm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Trend&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;413&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seasonalm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Seasonality&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;414&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;residualm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Residuals&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tight_layout&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_33_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;This model has identified a trend increase in election year 2016, which seems to make sense. However, it overfit the spike seen around election day 2016, and we can see the result of that overfit in the residuals which dip extremely a year before and after election day. In a future blog post, we will look at working around this by marking the key dates as holidays so that the algorithm doesn't overfit those days. The seasonality trend has also found something pretty expected, which is that hits on that page seem to breathe with the typical American school year. That is, we can see in the seasonal trends that there are many students using Wikipedia (hopefully as a starting point and not a primary resource) for essay papers and homework answers on Abraham Lincoln.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seasonalm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Abraham Lincoln Wiki Page Hits Seasonal Trend + Key dates + Shaded School Year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linewidth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;important_dates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-02-15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-02-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-02-19&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                   &lt;span class="s1"&gt;&amp;#39;2015-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="s1"&gt;&amp;#39;2015-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;xc&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;important_dates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-07-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-03-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;40000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;(-10000, 40000)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_35_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Zooming in on the residuals, we see again how the overfitting to the special events (election and inauguration) hurt the accuracy of the models.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;residualm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Abraham Lincoln Wiki Page Hits Seasonal Residuals + Key dates&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linewidth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;important_dates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;xc&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;important_dates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-12-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-02-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;40000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;40000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;(-40000, 40000)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_37_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Now we have stated a hypothesis without backing it up, namely that the seasonality over the year in page hits for the Wikipedia entry for Abraham Lincoln reflects the patterns of the American school year. This is pretty impossible to prove without data that is impossible or not practical to obtain, namely we would have to have the IP addresses of all those page hits and tie those in to schools and households with students, etc. Never going to happen. But we can strengthen our confidence in our hypothesis by testing it in the negative, that is, what will we see if we pick a topic which we do &lt;em&gt;not&lt;/em&gt; expect to be tied to school-year patterns, a topic students would rarely ever look up for school work? Let's try the American telecom Sprint.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymax&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_views&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;en.wikipedia&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;granularity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;daily&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20150701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20180701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_dict&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Daily Page Counts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{} Wiki Page Hits + Key dates + Shaded School Year&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;linewidth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;important_dates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-02-15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-02-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-02-19&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                       &lt;span class="s1"&gt;&amp;#39;2015-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                       &lt;span class="s1"&gt;&amp;#39;2015-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;xc&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;important_dates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-07-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-03-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ymin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymax&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_wiki_seasonal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymax&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_views&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;en.wikipedia&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;granularity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;daily&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20150701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20180701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_dict&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Daily Page Counts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;decompositionm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seasonal_decompose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;freq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;additive&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;seasonalm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decompositionm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seasonal&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seasonalm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{} Wiki Page Hits Seasonal Trend + Key dates + Shaded School Year&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;linewidth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;important_dates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-11-08&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-01-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-02-15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-02-20&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-02-19&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                       &lt;span class="s1"&gt;&amp;#39;2015-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-12-25&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                       &lt;span class="s1"&gt;&amp;#39;2015-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2016-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2017-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2018-07-04&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;xc&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;important_dates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvspan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2017-09-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-06-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;facecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-07-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2018-03-01&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ymin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ymax&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Sprint&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_seasonal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Sprint&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_40_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_40_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;The seasonality trend is scarred by incorporating a singular spike in data (the additive model tries to balance bias and variance, but obviously both can break at the same time), but we see no pattern tied to the school year. (One flaw is that the hits on the Sprint wiki page are much lower to begin with, so it isn't as reliable of a statement.) Let's try another topic which we suspect should breathe with the school year, US President George Washington.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;George Washington&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;80000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_seasonal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;George Washington&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;20000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;60000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_42_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_42_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;The trend here is less pronounced, but still evident. While we are on the topic, we present below, without commentary, a comparison on page hits between Donald Trump and Bill Clinton. I present both on the same scale to show the extraordinary difference in the magnitude of public interest in each individual. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Donald Trump&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_seasonal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Donald Trump&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;200000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_44_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_44_1.png" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Bill Clinton&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_wiki_seasonal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Bill Clinton&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;200000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_45_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_45_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Let's make use of Prophet now, because it has nicer graphs and seems a little more robust in my limited usage so far. We've used it above, but I will walk through a little more slowly this time. First we must create a Prophet object, and fit our dataframe to Prophet such that there is a datetime column labeled ds, and the counts value column is relabeled y.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Prophet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yearly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;weekly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mcmc_samples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seasonality_prior_scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;proLincoln&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dfLincoln&lt;/span&gt;
&lt;span class="n"&gt;proLincoln&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dfLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;
&lt;span class="n"&gt;proLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;Daily Page Counts&lt;/th&gt;
      &lt;th&gt;ds&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-01&lt;/th&gt;
      &lt;td&gt;15223&lt;/td&gt;
      &lt;td&gt;2015-07-01&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-02&lt;/th&gt;
      &lt;td&gt;15137&lt;/td&gt;
      &lt;td&gt;2015-07-02&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-03&lt;/th&gt;
      &lt;td&gt;17291&lt;/td&gt;
      &lt;td&gt;2015-07-03&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-04&lt;/th&gt;
      &lt;td&gt;19697&lt;/td&gt;
      &lt;td&gt;2015-07-04&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-05&lt;/th&gt;
      &lt;td&gt;18149&lt;/td&gt;
      &lt;td&gt;2015-07-05&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;proLincoln&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;proLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Daily Page Counts&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="n"&gt;proLincoln&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;y&lt;/th&gt;
      &lt;th&gt;ds&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-01&lt;/th&gt;
      &lt;td&gt;15223&lt;/td&gt;
      &lt;td&gt;2015-07-01&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-02&lt;/th&gt;
      &lt;td&gt;15137&lt;/td&gt;
      &lt;td&gt;2015-07-02&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-03&lt;/th&gt;
      &lt;td&gt;17291&lt;/td&gt;
      &lt;td&gt;2015-07-03&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-04&lt;/th&gt;
      &lt;td&gt;19697&lt;/td&gt;
      &lt;td&gt;2015-07-04&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2015-07-05&lt;/th&gt;
      &lt;td&gt;18149&lt;/td&gt;
      &lt;td&gt;2015-07-05&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;proLincoln&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;fbprophet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forecaster&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;Disabling&lt;/span&gt; &lt;span class="n"&gt;daily&lt;/span&gt; &lt;span class="n"&gt;seasonality&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="n"&gt;prophet&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;daily_seasonality&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;True&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="kd"&gt;override&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="sr"&gt;/home/d7082791602/.local/lib/python3.6/site-packages/pystan/&lt;/span&gt;&lt;span class="n"&gt;misc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;399&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;FutureWarning&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Conversion&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;second&lt;/span&gt; &lt;span class="n"&gt;argument&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;issubdtype&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;float&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;floating&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;deprecated&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="n"&gt;will&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;treated&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;float64&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;dtype&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;float&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
  &lt;span class="n"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;issubdtype&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asarray&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="n"&gt;dtype&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;float&lt;/span&gt;&lt;span class="o"&gt;):&lt;/span&gt;





&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;fbprophet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forecaster&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Prophet&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mh"&gt;0x7f7fbdf32cc0&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_future_dataframe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;periods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;forecast&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;forecast&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_components&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_50_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_50_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Here we see that prophet also very nicely picks out the 2016 trend, and clearly picks out the school year trend as well as the weekday trend. In order to make these quick peaks at the data more systematic, we create and use the following function. We then use these functions to take a look at a varied array of Wikipedia pages and conjecture a bit about the results.&lt;/p&gt;
&lt;p&gt;The first one we take a look at is "Christmas" which we expect, and indeed find, has a very clean seasonality. Note the weekday trend line shows a preference for some days over others, which is an artifact simply of which day the holiday fell on in the years that are used for training (since this holiday doesn't fall on any particular weekday by design, and we only trained based on three years, those three days in occured on, or rather Christmas Eve, will see the bias. That would be Thursday/Friday 2015, Sunday/Monday 2016, and Monday/Tuesday 2017 [2016 was a leap year]).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;starting&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20150701&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ending&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;20180804&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Prophet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yearly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;daily_seasonality&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;weekly_seasonality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mcmc_samples&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seasonality_prior_scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_views&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;en.wikipedia&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;granularity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;daily&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;starting&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ending&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_dict&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{} Wikipedia Page Hit Counts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rename&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_future&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_future_dataframe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;periods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;365&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_forecast&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_components&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_forecast&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Christmas&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_53_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_53_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_53_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;Now let's look at something that shouldn't really have too much seasonality, the term eclipse. Eclipses happen on a regular basis, of course, and physics predicts them extremely accurately, but human observation of eclipses happens irregularly. Here we can see that the major eclipse event of 2017 is so strongly represented in the data that it ends of defining the very inacurate model that results.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Eclipse&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_55_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_55_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_55_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;In other cases, we might not expect a seasonality, but the decomposition can show us trends which might have sociological interest. For example, the social status of the LGBTQ+ community is one that was frequently in the news earlier this century, but with the legalization of Gay Marriage in a way that terminated the need for further debate on the topic (Supreme Court ruling), and the topic in general becoming less and less heated as social acceptance deepens, one might expect and indeed does find a decreasing trend in hits for the term "Gay" on wikipedia. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Gay&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_57_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_57_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_57_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;Other topics will have found greater frequency in the American dialectic (recall that we are looking at English wikipedia, which we suppose is likely dominated by American viewers), such as Russia, given recent events related to the 2016 election.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Russia&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_59_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_59_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_59_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;Furthermore, we can see the fading of pop culture stars, such as the declining trend with Beyonce. Again, we see that the none of the output here is very trustworthy except perhaps the overall trend. Events such as awards ceremonies, album releases, and gossip events result in spikes which then dominate the seasonality models.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Beyoncé&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_61_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_61_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_61_2.png" /&gt;&lt;/p&gt;
&lt;p&gt;Returning to our theme above that some wiki topics breathe with the school year, electron is surely one of those topics.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;prophet_wiki_df&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Electron&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_63_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_63_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="png" src="assets/assets20180805/output_63_2.png" /&gt;&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;Statistical tools for seasonal decomposition are a great start in trying to predict time series which have some predictability built in. For topics that have a much greater stochastic characteristic, these tools become much more difficult to use properly. Blog entries here will continue to explore these tools and go into greater detail about the math behind them and how to use the tools in more sophisticated ways. Initial impressions from this exploration here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;There are some time series which are nearly perfectly predictable, such as that for the page hits on the topic of Christmas, which is an event that happens once per year and is limited in scope to a small minority of weeks in the entire year.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Other trends are fairly predictable, such as electron, because of its association with school work and the predictable seasonality of school. Interestingly, the trends one finds with topics like this show the "hit" that the holiday break seems to have on education, where the end of year break is preceeded with a sort of winding down and then followed by a winding up, both of which are not particularly rapid.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Trends that have an educational component, such as popular US Presidents like Abraham Lincoln, are complicated by holidays such as president's day, elections, and inaugurations. &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Trends from pop culture, such as Beyonce, can possibly trace the popularity of a celebrity but, are complicated by things such as album releases, awards ceremonies, gossip outbreaks, etc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sometimes, a massive surge in interest in a topic due to some even can entirely throw off seasonal decomposition, and such events will have to be 'windowed out' and interpolated to get an accurate picture of the routine behavior of the time series.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some topics show the decline in interest in the topic in general, or in some cases, an increasing normalization of a topic such that it gets less page views over time.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some topics are so random that speaking about trends and seasonality is nonsense. However, these models can easily overfit that data and give you a false sense of confidence that will inevitably be proven wrong.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="Statistics"></category><category term="Data Science"></category><category term="Python"></category><category term="Wikipedia"></category></entry><entry><title>A Risk Analysis Bowtie Diagram in Latex</title><link href="http://3implieschaos.org/a-risk-analysis-bowtie-diagram-in-latex.html" rel="alternate"></link><published>2018-06-24T19:27:00-04:00</published><updated>2018-06-24T19:27:00-04:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-06-24:a-risk-analysis-bowtie-diagram-in-latex.html</id><summary type="html">&lt;h3&gt;Bowtie Diagram in LaTeX&lt;/h3&gt;
&lt;p&gt;For folks who have to conduct risk analysis, there are
very limited choices for the creation of "bowtie diagrams".
Searching the web for examples in LaTeX comes up pretty empty.
So when googling comes up empty, its time to create:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/3implieschaos/latex-demos/blob/master/figures/bowtie/bowtie.tex"&gt;Bowtie diagram in LaTeX example&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;This code results in a diagram that looks pretty acceptable
in terms of quality, or at least an acceptable starting point:&lt;/p&gt;
&lt;p&gt;&lt;img alt="bowtie diagram" src="assets/bowtie.png" /&gt;&lt;/p&gt;</summary><category term="LaTeX"></category><category term="Diagrams"></category><category term="Risk Analysis"></category></entry><entry><title>New York Times should know better</title><link href="http://3implieschaos.org/new-york-times-should-know-better.html" rel="alternate"></link><published>2018-02-24T19:27:00-05:00</published><updated>2018-02-24T19:27:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2018-02-24:new-york-times-should-know-better.html</id><summary type="html">&lt;h3&gt;Quick Overview&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A New York Times article flirts with the idea that you can will away excess fat and have a longer lifespan.&lt;/li&gt;
&lt;li&gt;Article reads like a press release rather than scientific journalism.&lt;/li&gt;
&lt;li&gt;There may be much more plausible ways to present the study findings.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Entry&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.nytimes.com/2018/02/22/well/move/how-our-beliefs-can-shape-our-waistlines.html"&gt;This&lt;/a&gt; New York Times article
has a rather stunning headline.&lt;/p&gt;
&lt;p&gt;&lt;img alt="theheadline" src="assets/nytheadline20180222.png" /&gt;&lt;/p&gt;
&lt;p&gt;How our beliefs can shape our waistlines. No, this isn't 1974. Yes, that headline implies far more than what 
the science it discusses and the article itself can promise. (I have read that very often it is the 
case that the headline is set by editors rather than the journalist, with the goal of grabbing the readers
attention, so some commercial "poetic" license is to be expected.)&lt;/p&gt;
&lt;p&gt;I have seen enough instances where journalism
hits upon something I'm familiar with, or was a part of in some way, to know that journalism is to reality what
painting is to pictures. Very good journalist are like very good classical painters, and what they portray
can capture the reality of what they are reporting on with a high level of verisimilitude. Some journalist
are more like abstract painters, and what you read is an interpretation of reality with some very extreme
liberties taken. A healthy civic body will be filled with individuals trained in critical thinking who will
have an open-minded but skeptical way of consuming "news". Sometimes you have to triangulate your news. For 
example, reading a report on something from a liberal leaning source and a conservative leaning source will
likely give you a fuller picture of the subject being reported than you would get from reading either alone. &lt;/p&gt;
&lt;p&gt;When it comes to science journalism, however, there is sometimes, perhaps often, the complication that the
journalist reporting on a study or discovery may not be entirely qualified to understand it. After all, the
scientist who produced the study or claim the discovery have spent years, often decades, deeply entrenched
in their field of study. And the scientific endeavor has become highly specialized such that no one person
could know many fields deeply enough to be consider an expert in them all. This is all to say that the job
of being a science journalist (including health-focused journalism) is a very difficult one, and one that
I respect deeply. It was science journalism that planted the seeds for my passion for science when I was a little
kid. &lt;/p&gt;
&lt;p&gt;Let's get to why I find this one article problematic. It opens with a very promising paragraph that,
though carefully fused with the words might, suggests, and hints, basically boils down to "mind over
matter might be real!" That kind of thinking was very popular in the 1960s and 1970s, and let's be 
honest, lots of scientist hooked into that kind of thinking in extreme ways, e.g. ESP research, not
to mention that researcher who killed an elephant with LSD. In more recent times we have something 
called "mindfulness" which is a much more legitimate line of research, though the jury is 
&lt;a href="https://www.scientificamerican.com/article/wheres-the-proof-that-mindfulness-meditation-works1/"&gt;still out&lt;/a&gt;
on how effective it is for our health. &lt;/p&gt;
&lt;p&gt;In any case, there is pretty solid evidence that our
psychological state of mind &lt;a href="https://www.scientificamerican.com/article/wheres-the-proof-that-mindfulness-meditation-works1/"&gt;impacts our health&lt;/a&gt;.
I have the impression that the medical field has been very careful to approach this issue in such a way
as to avoid any association or hints of the woo woo history of "mind over matter", which is one reason
why this article surprised me.&lt;/p&gt;
&lt;p&gt;Quoting &lt;em&gt;The Times&lt;/em&gt; on the study in question (they also mention an earlier study that had less than 100 subjects,
a number too small to draw any statistically sound conclusions and so I won't even mention further):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;They found strong correlation between people’s dying early and their believing that they were relatively inactive, 
even if their accelerometer data indicated that they were getting as much exercise as others their age in this group. 
Risk of early death was up to 71 percent higher than for the group that, correctly or not, felt confident that they 
exercised more than their peers. This correlation held true when the researchers controlled for chronic diseases, 
socioeconomic status, smoking and other factors.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That last sentence is key. That last sentence is so incredibly key that it should have gotten at least one entire
paragraph to itself, two or three would have made me happy. That's where the magic happens!&lt;/p&gt;
&lt;p&gt;OK, so I don't have the article because it is pay-walled (can we please move beyond this pay-wall nonsense? It is 2018
and pay-walls on journals do nothing to help science and everything to line the pockets of the journal publishers).
So you might say, well shut up then. But I won't shut up, because the New York Times didn't, and also because I have
the abstract! When I read the 
&lt;a href="https://www.ncbi.nlm.nih.gov/pubmed/28726475"&gt;abstract&lt;/a&gt;
my eyes were desperately looking for the words "calories" and "metabolism" (bonus points for body fat percentage!). 
Did I find it? &lt;a href="http://psycnet.apa.org/record/2017-31316-001"&gt;Nope&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;adjusting for actual levels of physical activity, health status and behavior, and sociodemographic variables.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That's OK in general, were it not for the conclusions that &lt;em&gt;The Times&lt;/em&gt; and the authors are pointing at. It is a 
very, very &lt;em&gt;fascinating&lt;/em&gt; finding, worthy of greater discussion and further investigation. But to draw conclusions
from this study to bring to the public based on these preliminary results, when two super important variables
don't seem to have been considered, is highly problematic.&lt;/p&gt;
&lt;p&gt;In the abstract of the journal article, the authors conclude:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Individuals’ perceptions about their level of physical activity strongly predicted mortality, even after accounting for the effects of actual physical activity and other known determinants of mortality. This suggests that perceptions about health behaviors may play an important role in shaping health outcomes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And &lt;em&gt;The Times&lt;/em&gt; concludes:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This type of study cannot prove that exercise beliefs directly cause life spans to shorten or grow; it can show only that the two issues are related. But a perception that other people your age out-exercise you “could have physiological costs,” Zahrt says — by, for example, increasing levels of stress hormones, which are known to have deleterious health effects. Self-comparisons might also dampen exercise motivation, leading to declining health. But already, this study intimates that “our mind-sets color our experience of the world,” Zahrt says. It might be beneficial to reframe your walk from the car to the office not as an inconvenience but a brief but meaningful workout.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Yes, &lt;em&gt;The Times&lt;/em&gt; is careful here to state this this study doesn't prove the connection, but then it closes with some advice which
basically suggests that it "might be beneficial" if the reader were to assume that the suggestion that "beliefs directly cause life spans" to 
change and try to recast their daily narrative in terms of deluding themselves into thinking they are working out more than they actually are.&lt;/p&gt;
&lt;p&gt;Here's why that could be harmful. First of all, back to the C word, the study doesn't seem to account for calories. Calories brings
in a ton of possibilities here. For example, perhaps the subjects who overestimated their level of daily activity relative to their
cohorts did so because they ate less. I have hiked the same path before on an empty stomach and on a full stomach, and the exertion
I felt on an empty stomach felt a lot more substantial than that I felt on a full stomach, even though I was walking the same path. 
Also, metabolism varies between individuals in the same cohort, and metabolism is not so easy to measure, most definitely it 
can't be measured with the simple accelerometer used in this study. Metabolism and caloric intake are &lt;em&gt;incredibly&lt;/em&gt; important factors,
and this study, due to the nature of the data, don't even touch on them. Somebody with a higher metabolism might feel that they
have worked out more than their cohorts because, effectively, their bodies have worked out more than their cohorts. Even if they
had consumed the same amount of calories as their cohorts, their body would have burned more as well due to the higher metabolism, and
that might feed into their perception of working out more than they actually have. Or it could be, more likely, a very complex
interplay of all these factors, but of all these factors, metabolism and caloric intake are two primary ones. Any study like 
this that doesn't factor those in is going to be missing something potentially substantial that may lead to a differing conclusion.  &lt;/p&gt;
&lt;p&gt;I wish I could have read the article further before making these criticisms, but since the authors teamed up with &lt;em&gt;The New York Times&lt;/em&gt;
and published in a pay-walled journal, this criticism is fair-game with the asterisk that the authors may have addressed this 
inside the actual article (but that is highly unlikely because the data didn't have subjects metabolic and caloric information).&lt;/p&gt;
&lt;p&gt;Further I should state that my training is in Physics, not medicine or psychology. Some physics people think that because 
they have studied a subset of Physics (nobody can study all of physics anymore, its too big and specialized) that gives them
a blanket expertise on the world. I have no expertise in the field this study covers, but I am somewhat familiar with the outlines
of this field as health and weight loss are something I have spent time focusing on. Notice that my critique is not with what
the authors say (except their conclusions) but rather with what they don't say. As somebody with scientific training I think
it is fair game to ask questions such as "what about these other variables which you have ignored" and "how is your 
conclusion justifiable if you ignored these other variables." In other words, science is a culture of skepticism, and that
skeptical training is the foundation of all the fields of science.&lt;/p&gt;
&lt;p&gt;So what conclusion do I think they should have drawn instead. Here is how I would have written it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In a study with a sample size of 61,141 adults from data drawn over three year time spans
which contains a number of variables such as actual levels of physical activity as measured by an 
accelerometer, health status and behavior, and sociodemographic variables, but does not
contain data on caloric intake or metabolic metrics of the subjects, we find an interesting 
correlation between relative belief in ones level of exercise and mortality. Specifically, 
individuals who perceived themselves as less active than others were up to 71% more likely to 
die in the follow-up period than those who perceived themselves as more active. This finding 
held across 3 samples and after adjusting for actual levels of physical activity and other covariates. 
Further studies will be needed which incorporate more accurate medical data, such as metabolism 
metrics, as well as accounting for actual caloric intake, to discern the causation of this correlation.
By controlling for these key variables in human health outcomes as well as the variables accounted
for in this study, future research can determine to what extent, if any, do perceptions about 
health behaviors play in shaping health outcomes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And for &lt;em&gt;The Times&lt;/em&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;While it is too soon to draw any conclusions from this study, future research may help verify
or debunk the intriguing possibility the study raises. Is it possible that the narrative we 
create about our daily lives, specifically how active we perceive ourselves to be, 
can give us a statistical nudge towards longer, healthier life spans?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A reader reading that conclusion would not take it as advice which may cause them to forego 
other more established advice, but rather as a good reason to stay tuned and continue to do
the healthy things their doctors recommend. Frankly, I'd much rather imagine my walk to a local
store as being as effective as thirty minutes on the treadmill than to actually &lt;em&gt;spend&lt;/em&gt; thirty
minutes on the treadmill, but something tells me that just ain't so.&lt;/p&gt;</summary><category term="New York Times"></category><category term="Woo Woo"></category><category term="Science"></category><category term="Research"></category><category term="Studies"></category></entry><entry><title>TRAPPIST-1 is probably not alive</title><link href="http://3implieschaos.org/trappist-1-is-probably-not-alive.html" rel="alternate"></link><published>2017-02-24T21:27:00-05:00</published><updated>2017-02-24T21:27:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2017-02-24:trappist-1-is-probably-not-alive.html</id><summary type="html">&lt;h2&gt;Quick overview&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;It was recently announced that a nearby star, TRAPPIST-1,
has been found to have additional planets (some were discovered prior to this study)
which exist in a potentially
life-hosting region around the star.&lt;/li&gt;
&lt;li&gt;Astronomically speaking, TRAPPIST-1 is pretty close to
us and thus if it does host life then it will be a promising
candidate for spectrographic evidence.&lt;/li&gt;
&lt;li&gt;However, the nature of the star and the configuration of
the planets means that there are some good reasons to be
skeptical that any of those planets do host life.&lt;/li&gt;
&lt;li&gt;Also, it is practically impossible with our current
technology to visit that system with unmanned probes,
let alone (hu)maned missions.&lt;/li&gt;
&lt;li&gt;The distances in space are so vast and the restrictions
that the laws of Physics place on space travel are so stringent
that we would probably have to completely exploit our entire
planet's resources to even have a chance to visit that solar
system within 10,000 years.&lt;/li&gt;
&lt;li&gt;We are probably not alone in the universe, but we are
also probably very, very rare, and we likely won't meet
any alien intelligence before we go extinct.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Deeper Dive&lt;/h2&gt;
&lt;p&gt;An &lt;a href="http://nature.com/articles/doi:10.1038/nature21360"&gt;article published in the science journale &lt;em&gt;Nature&lt;/em&gt;&lt;/a&gt;
(Gillon et al., &lt;em&gt;Nature&lt;/em&gt;, &lt;strong&gt;542&lt;/strong&gt;, February 23, 2017) made many mainstream media
headlines by announcing the discovery of new terestrial planets around a nearby
star. &lt;strong&gt;CNN&lt;/strong&gt; was pretty tame by &lt;a href="http://www.cnn.com/2017/02/22/world/new-exoplanets-discovery-nasa/"&gt;announcing&lt;/a&gt; that &lt;em&gt;Astronomers discover 7 Earth-sized planets orbiting nearby star&lt;/em&gt; in their headline. The &lt;strong&gt;New York Times&lt;/strong&gt; was
equally tame in &lt;a href="https://www.nytimes.com/2017/02/22/science/trappist-1-exoplanets-nasa.html?_r=0"&gt;announcing&lt;/a&gt; that &lt;em&gt;7 Earth-Size Planets Orbit Dwarf Star, NASA and European Astronomers Say&lt;/em&gt;. &lt;strong&gt;NBC&lt;/strong&gt; went a little
louder with the &lt;a href="http://www.nbcnews.com/mach/space/living-trappist-1-planets-would-be-very-strange-n725206"&gt;headline&lt;/a&gt;
&lt;em&gt;Living on the TRAPPIST-1 Planets Would Be Very Strange&lt;/em&gt;, which, let's be clear, suggest to the average reader
that those planets are in fact habitable, which is not confirmed yet (more on that soon).
&lt;strong&gt;CNET&lt;/strong&gt; was &lt;a href="https://www.cnet.com/pictures/trappist-1-star-system-could-host-life-exoplanets-earth-like/"&gt;bolder&lt;/a&gt;
with a headline &lt;em&gt;'Incredible' star system could host life&lt;/em&gt;, but the "could" was a good word to use though
it spoke nothing to the actual probability. I &lt;em&gt;could&lt;/em&gt; win the lottery and get struck down by lightening and
then a meteor could hit the ambulance carrying me to the hospital, but I'm not going to bet on it.
The UK &lt;strong&gt;Telegraph&lt;/strong&gt; &lt;a href="http://www.telegraph.co.uk/science/2017/02/22/nasa-announcement-live/"&gt;pushed it&lt;/a&gt; a bit
further with the headline &lt;em&gt;Nasa discovers new solar system TRAPPIST-1 - where life may have evolved on three planets&lt;/em&gt;.
The &lt;strong&gt;Guardian&lt;/strong&gt; &lt;a href="https://www.theguardian.com/science/2017/feb/24/lab-notes-is-there-life-on-exoplanets-orbiting-trappist-1"&gt;asked&lt;/a&gt;
&lt;em&gt;is there life on exoplanets orbiting Trappist-1?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Even &lt;strong&gt;Fox News&lt;/strong&gt; got in on the fun by &lt;a href="http://www.foxnews.com/science/2017/02/23/keys-to-life-scientists-explain-how-newly-discovered-exoplanets-could-be-habitable.html"&gt;asking a science reporter&lt;/a&gt; whether
this was "just a big deal or a way to get the general public interseted in space exploration to insure that it's
properly funded...?" in a video with the title "Could New Earth-like Planets Be Ripe for Colonization?"&lt;/p&gt;
&lt;p&gt;&lt;img alt="FoxNews" src="assets/trappist1isprobablynotalive-ad220.png" /&gt;&lt;/p&gt;
&lt;p&gt;For the record, I don't have an issue with those headlines, as if that would matter anyway. I'm even
a bit fond of that &lt;a href="http://io9.gizmodo.com/nasa-is-turning-trappist-1-into-science-nerd-fanfic-1792713502"&gt;creative website&lt;/a&gt;
that some planetary scientist have put up to host information and fan fiction related to TRAPPIST-1.
The more public interest they can drum up for their work, the more grant money that will
flow towards planetary and exoplanetary science.&lt;/p&gt;
&lt;p&gt;However, let's bring this discussion back down to Earth for a moment.&lt;/p&gt;
&lt;h3&gt;Some background on TRAPPIST-1&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/TRAPPIST-1"&gt;TRAPPIST-1&lt;/a&gt; is a very small and relatively cold
star that is about 40 light-years away from our solar system. TRAPPIST-1's radial velocity
is 56.3 km/s towards us, which isn't very fast. For example, the Juno spacecraft's maximum
speed was about 73.6 km/s. The fastest speed of a (hu)manned spacecraft was achieved by
Apollo 10 at about 11.08 km/s.&lt;/p&gt;
&lt;p&gt;TRAPPIST-1 is so dim you can't see it without a strong telescope.&lt;/p&gt;
&lt;p&gt;Two things are interesting about our findings on exoplanets: it is pretty common for a star to have planets (just a few decades ago this wasn't an accepted reality); and our solar system seems to be a bit of an outlier in terms of the configuration of planets around the star based on what we've seen so far. A lot of these systems have Jupiter size or larger planets in very close orbit around the star; in the case of TRAPPIST-1, the star is much much weaker than the sun and all the planets we've found are in a very close tight orbit. This later fact may be due to selection bias, i.e. it is easier to find planets around a star when the planets are large and very close because the motion of the star is more strongly affected (for Doppler-effect discovered planets and also the luminosity detection method) and also when they are closer to the star and the plane of orbit is nearly head on relative to Earth. Also, of course, an Earth sized planet is going to cause a bigger
dip in the intensity of light of a dwarf star when passing in between our telescopes and that star than would a similar size planet,
say ours, have on a larger star like our sun (which itself isn't all that big compared to some of the giant stars that can be
found in the universe, but is substantially bigger than TRAPPIST-1). So
right now the limitations of our detection technology is creating a statistical bias towards systems for which it is better
able to detect exoplanets. As the next generation observation equipment is developed, we may start finding more solar systems
which resemble ours.&lt;/p&gt;
&lt;h3&gt;Why we are excited about this discovery&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Three of the planets are believed to be capable of hosting liquid water oceans.
Having liquid water oceans vastly increases the chances a planet could host
life.&lt;/li&gt;
&lt;li&gt;Ultracool stars, which TRAPPIST-1 is classified as, are &lt;a href="http://www.trappist.one/#about"&gt;the most common type&lt;/a&gt; of
stars in our galaxy. The fact that TRAPPIST-1 has so many planets and so many planets that
are within the potentially habitable zone bodes well for our chances of finding life-hosting
exoplanets if the negatives in the next section aren't enough to stop life from evolving.&lt;/li&gt;
&lt;li&gt;Because the stars are so small, it is easier to see the dip in light which an Earth-sized
planet would cause if it passes between us and TRAPPIST-1. TRAPPIST-1's solar system's orbital
plane happens to be position just right for us to see these planets crossing the star; random
chance says that only a ver small percentage of solar systems would yield this lucky result.
However, because ultracool stars are so common, the odds are in our favor that we will continue
to discover similar systems.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Why we shouldn't be too excited about this discovery&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The planets are probably tidally locked or near tidally locked and suffer run-away green house effects. One side of
planet always faces the sun, the other always faces dark space. The resulting temperature differential would result
in massive global winds if the planets retain their atmospheres. There is still a lot of &lt;a href="https://arxiv.org/abs/1602.05176"&gt;debate&lt;/a&gt;
about where the habitable zone is for tidally locked systems, and the predictions that three of these planets
exist in the "Goldilocks zone" are not settled science.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;As the director of the Carl Sagan Institute,
Lisa Kaltenegger, points out, these planets are incredibly close to their star
and their star could be emitting intense levels of ultraviolet light. UV radiation
is dangerous for life as we know it, so in order to host light the planets would
need some very serious ozone protection. Alternatively, assuming they had oceans,
and that their oceans didn't boil away or freeze over, life would probably be limited
to deep oceans.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ultracool dwarfs are often violent stars with massive flares. However, TRAPPIST-1 is
relatively peaceful, according to some of the reports.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;They may possibly have lost their atmospheres due to being so close to the star.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It is only about 500 million years old, so there hasn't been much time for
life to evolve even if the above issues didn't prevent said evolution. These
stars, unlike ours, can hypothetically last for &lt;strong&gt;trillions&lt;/strong&gt; of years since
they &lt;a href="http://onlinelibrary.wiley.com/doi/10.1002/asna.200510440/abstract"&gt;burn their hydrogen fuel much more slowly&lt;/a&gt;
than larger stars:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="trillions" src="assets/trappist1isprobablynotalive-c401a.png" /&gt;&lt;/p&gt;
&lt;p&gt;Even if some of oceans remain and are frozen over, that doesn't rule out life.
Some of the moons in our solar system have frozen oceans of water where there is a suspected liquid layer underneath that could possible host life (e.g. Europa) which is why NASA has an interest in looking for potential life on Europa. So the conditions of the TRAPPIST-1 system may support some form of life but like with Europa, the ability for complex life to develop is highly limited due to lack of resources. Also, life can be fragile, and Earth went through many periods of mass extinctions; if any of the planets around TRAPPIST-1 have life, they are probably relegated to small regions in the twilight zones (that is, if one side always faces the star and the other always faces empty space, the part of the planet between these two zones would be in permanent twilight and have the mildest climates if the planets still have their atmospheres) making life on those planets much more vulnerable to total extinction, a fate Earth avoided in part due to being almost entirely habitable and thus having a more diverse biosphere.&lt;/p&gt;
&lt;h2&gt;Sobering Conclusions&lt;/h2&gt;
&lt;p&gt;Forty lightyears is a long way away. Apollo 10's max speed was around 11082.5 m/s which is the fastest manned craft speed we've ever obtained. That's slower than how fast TRAPPIST-1 is moving toward us. 40 light years is 3.784e+17 meters away. If Apollo 10 went directly towards TRAPPIST-1 at its maximum obtained speed, it would close the distance at a rate of about 67082.5 m/s (the sum of its speed relative to Earth and the speed of TRAPPIST-1 relative to Earth using Galilean Relativity, these speeds are too slow to justify using Einstein's Relativity). It would take Apollo 10 approximately 5.6408154e+12 seconds to make it to TRAPPIST-1. That's nearly 178,846 years. Rocket technology hasn't changed radically since then. And, of course, the astronauts wouldn't live long enough to get even
a tiny fraction of the way there.&lt;/p&gt;
&lt;p&gt;Even if the entire world turned all of their defense spending towards producing a &lt;a href="https://en.wikipedia.org/wiki/Generation_ship"&gt;Generation ship&lt;/a&gt; to reach TRAPPIST-1 and impoverished the planet's resources to supply fuel and food supplies for said ship, we are still talking many tens of thousands of years at best, ignoring all threats to human life such as radiation, collision with stray objects, etc. One could easily imagine that within a few generations, the community on the generational
ship would lose faith in their great-grandparent's mission and turn the ship around, assuming they had enough fuel to do so.
It is likely they would, as they would have to have some breaking capacity once they reach TRAPPIST-1, and then enough fuel
to escape TRAPPIST-1's gravity well. All to say that this is never going to happen.&lt;/p&gt;
&lt;p&gt;Science fiction has sparked our imagination of traveling to the stars, but the cold reality is that while there is probably a lot of life off Earth in this Universe, everybody is trapped in their own solar systems by relativity and the vast distances between stars. Also, Earth is about 4.5 billion years old and we have about another 5 billion years until our sun eats its inner planets. So who knows what can happen in those five billion years. But just keep in mind that human-level intelligence is probably very rare in any case. Some scientist &lt;a href="http://www.npr.org/sections/krulwich/2012/10/22/163397584/how-human-beings-almost-vanished-from-earth-in-70-000-b-c"&gt;have proposed based on genetic evidence&lt;/a&gt;
that at one point about 75,000 years ago the human species was once reduced to 3,000 - 10,000 individuals due to climate catastrophes. We were so close to extinction we could probably taste it. Earth was very close to losing its human population, in which case today it would be a wild planet whose greatest intelligence might be the non-human apes that survive today. Not only must a planet have the right conditions for life, it must also have the right conditions for complex life, and even then, it's going to take some luck to get to a human-like species.&lt;/p&gt;
&lt;p&gt;So we (complex intelligent life) are probably not alone but we are also probably very, very rare, and we likely won't meet any alien intelligence before we go extinct. Sorry bout it.&lt;/p&gt;
&lt;h2&gt;Coda&lt;/h2&gt;
&lt;p&gt;In regards to the discussion above on generation ships, there is something related to that known as
the &lt;a href="http://www.jbis.org.uk/paper.php?p=2006.59.239"&gt;Wait Calculation&lt;/a&gt; (A. Kennedy, &lt;em&gt;Interstellar Travel: The Wait Calculation and the Incentive Trap of Progress&lt;/em&gt;, JBIS &lt;strong&gt;59&lt;/strong&gt;, July 2006) which is relevant beyond the concept of a generation ship.&lt;/p&gt;
&lt;p&gt;From the abstract:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This paper describes an incentive trap of growth that shows that civilisations may delay interstellar exploration as long as voyagers have the reasonable expectation that whenever they set out growth will continue to progress and find quicker means of travel, overtaking them to reach and colonise the destination before they do. This paper analyses the voyagers' wait calculation, using the example of a trip to Barnard's Star, and finds a surprising minimum to time to destination at a given rate of growth that affects the expansion of all civilisations. Using simple equations of growth, it can be shown that there is a time where the negative incentive to travel turns positive and where departures will beat departures made at all other times. Waiting for fear future technology will make a journey redundant is irrational since it can be shown that if growth rates alter then leaving earlier may be a better option. It considers that while growth is resilient and may follow surprising avenues, a future discovery producing a quantum leap in travel technology that justifies waiting is unlikely.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kennedy derives a &lt;strong&gt;Wait Equation&lt;/strong&gt;: "The wait equation describes .. the
point at which the negative incentive to leave changes to a positive one; where the incentive to set out on the interstellar
journey is the strongest."&lt;/p&gt;
&lt;p&gt;The equation assumes that the growth rate of the speed of the potential ship per year is tied to the
general global GDP growth rate:&lt;/p&gt;
&lt;div class="math"&gt;$$ v(t) = v_0 (1 + r)^t$$&lt;/div&gt;
&lt;p&gt;where &lt;span class="math"&gt;\(v\)&lt;/span&gt; is the velocity &lt;span class="math"&gt;\(t\)&lt;/span&gt; years after the velocity is &lt;span class="math"&gt;\(v_0\)&lt;/span&gt; and &lt;span class="math"&gt;\(r\)&lt;/span&gt; is the average growth rate year over year.
Since velocity is inversely proportional to the time it would take to reach the star, we can rewrite this as&lt;/p&gt;
&lt;div class="math"&gt;$$ \frac{T_0}{T} = (1+r)^t $$&lt;/div&gt;
&lt;p&gt;where &lt;span class="math"&gt;\(T\)&lt;/span&gt; is the time it would take if we waited &lt;span class="math"&gt;\(t\)&lt;/span&gt; years for technology to evolve, and &lt;span class="math"&gt;\(T_0\)&lt;/span&gt; is the time
to take if we were to launch with today's current technology. The purpose of the &lt;strong&gt;Wait Equation&lt;/strong&gt; is to find the
sweet spot for launching such that to wait any longer would not return any advantage.&lt;/p&gt;
&lt;p&gt;We seek, then, the condition for which:&lt;/p&gt;
&lt;div class="math"&gt;$$ t  + \frac{T_0}{(1+r)^t} $$&lt;/div&gt;
&lt;p&gt;reaches a minimum. Using our previous rough estimate of 178,846 years for
Apollo 10 to reach TRAPPIST-1 and a growth rate of 1%,
we see that this minimum would happen about
seven centuries from now.&lt;/p&gt;
&lt;p&gt;&lt;img alt="WaitEquation" src="assets/trappist1isprobablynotalive-520e1.png" /&gt;&lt;/p&gt;
&lt;p&gt;The implication, if you accept the premises of this equation, is that
to ensure that the generation ship we launch won't be beat to the destination
by a faster model, we should wait about 700 years to launch.&lt;/p&gt;
&lt;p&gt;A word of warning, of course. This model is entirely unrealistic. It
would predict that we exceed the speed of light with our technology
in a little over 1000 years:&lt;/p&gt;
&lt;p&gt;&lt;img alt="noway" src="assets/trappist1isprobablynotalive-608bc.png" /&gt;&lt;/p&gt;
&lt;p&gt;So let's in no way see this as a valid physical prediction. Instead, let's see
it as sort of a conceptual starting point for a discussion about "the incentive
trap of progress." I'll revisit the &lt;em&gt;Wait Equation&lt;/em&gt; again in some future
blog post (probably) because it has applications elsewhere. For example,
it might help us understand why it may be better to avoid getting a first
or even second or third generation product. If you buy a first generation
product and you don't have a budget such that you can buy an upgraded product
for many years ahead, then you will suffer a poorer quality product than you
might if you waited a year or two for the next iterations of that product
to improve. However, if you wait too long, you also harm yourself by denying
yourself access to that product, and waiting too long means that the net
harm to yourself could exceed the harm of buying too early.&lt;/p&gt;
&lt;p&gt;Indeed, that's a potentially awesome post so let's plan to discuss it again soon.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</summary><category term="Astrophysics"></category><category term="Exoplanets"></category><category term="Space"></category><category term="Exobiology"></category></entry><entry><title>Putting a Space Station Over Philly With Final Cut Pro X</title><link href="http://3implieschaos.org/putting-a-space-station-over-philly-with-final-cut-pro-x.html" rel="alternate"></link><published>2017-02-20T19:27:00-05:00</published><updated>2017-02-20T19:27:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2017-02-20:putting-a-space-station-over-philly-with-final-cut-pro-x.html</id><summary type="html">&lt;h2&gt;Quick overview&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;If interested in creating special effects for film projects.&lt;/li&gt;
&lt;li&gt;Uses Final Cut Pro X and CoreMelt's TrackX Plugin's Simple
Tracker.&lt;/li&gt;
&lt;li&gt;In about thirty minutes you can create a passable video that portrays the Star War's Death Star over Philadelphia, PA USA.&lt;/li&gt;
&lt;li&gt;Resulting video:&lt;/li&gt;
&lt;/ul&gt;
&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/it_wj78IbFA" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;

&lt;h2&gt;Gathering the Software&lt;/h2&gt;
&lt;p&gt;I'll begin with an apology that the software discussed here requires Apple Mac* hardware to run. What we do here can be done with Adobe Premier Pro right out of the box.&lt;/p&gt;
&lt;p&gt;Assuming you have a Mac* device, this project also requires
&lt;a href="https://itunes.apple.com/us/app/final-cut-pro/id424389933?mt=12"&gt;Final Cut Pro&lt;/a&gt;. This is not cheap software, but I've found it to be worth it if you plan to be doing enough projects. I have many nieces and nephews and we've had an awesome time making movies with this tool.&lt;/p&gt;
&lt;p&gt;Using Keyframing, we could get a realistic tracking effect, but this would be a very tedious and time consuming way to proceed. Fortunately there is a plugin we can use that does the tracking nearly automatically.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://coremelt.com/products/trackx-powered-by-mocha"&gt;Coremelt's TrackX Plugin&lt;/a&gt; powered by &lt;a href="https://www.imagineersystems.com/products/what-is-mocha/"&gt;Mocha&lt;/a&gt; analyzes your video frame by frame and attempts to match the motion of the camera. The user needs only provide some very simple guidance.&lt;/p&gt;
&lt;h2&gt;Gathering the Media&lt;/h2&gt;
&lt;p&gt;A quick image search will yield a wide range of choices for images of a space station, in this case the Death Star, but keep an eye towards an example that would look realistic in the
context of your video. I chose an image that looked a lot
like what the moon looks like in the daytime.&lt;/p&gt;
&lt;p&gt;I also filmed a couple of scenes around Philadelphia,
being careful to move the camera enough to make it
seem realistic, but smoothly enough with no quick
motions to make tracking easier for myself.&lt;/p&gt;
&lt;h2&gt;Preparing the Death Star image&lt;/h2&gt;
&lt;p&gt;When you apply the image, however, you also must keep
in mind that if it doesn't match the shadowing seen in
the video, the viewer's mind will feel a bit off about it.
Look for the shadows in your video and flip the Death Star
image to match that direction using the &lt;em&gt;flipped&lt;/em&gt; effect:&lt;/p&gt;
&lt;p&gt;&lt;img alt="flipped" src="assets/PuttingSpaceStationOverPhilly-c9525.png" /&gt;&lt;/p&gt;
&lt;p&gt;That is, import the media, drag it down to your timeline, and then drag the &lt;em&gt;flipped&lt;/em&gt; effect to the corresponding timeline entry of the Death Star image. Next right click on that
clip and create a new compound clip:&lt;/p&gt;
&lt;p&gt;&lt;img alt="compound_clip" src="assets/PuttingSpaceStationOverPhilly-e69aa.png" /&gt;&lt;/p&gt;
&lt;p&gt;This is required for the TrackX plugin. Once you've done
that, the compound clip of the Death Star will show up
in your media and you can delete from your time line.&lt;/p&gt;
&lt;p&gt;Because I had one scene facing West and another facing East,
which is not recommended because that would imply two
Death Stars in the sky, I needed to create two compound
clips, one flipped from the other, in order to match
the sun direction.&lt;/p&gt;
&lt;h2&gt;Tracking your video clips&lt;/h2&gt;
&lt;p&gt;Next we can start the tracking process. Import your video
clips from your device or hard-drive and then drag the
corresponding file from the media section onto the timeline.&lt;/p&gt;
&lt;p&gt;Then, go to the &lt;em&gt;generators&lt;/em&gt; menu and select Simple Tracker
under the C2 TrackX entry:&lt;/p&gt;
&lt;p&gt;&lt;img alt="generators" src="assets/PuttingSpaceStationOverPhilly-230aa.png" /&gt;&lt;/p&gt;
&lt;p&gt;Drag that &lt;strong&gt;on top of&lt;/strong&gt; the video clip. Your timeline
will look something like this:&lt;/p&gt;
&lt;p&gt;&lt;img alt="timeline" src="assets/PuttingSpaceStationOverPhilly-a7eb0.png" /&gt;&lt;/p&gt;
&lt;p&gt;Above, I have three video clips and I have trimmed
the Simple Tracker to fit each one and thus have three
Simple Tracker entries in the timeline, one for each video.&lt;/p&gt;
&lt;p&gt;Click on the Simple Tracker entry on the timeline and you'll
now be able to set up tracking for your video:&lt;/p&gt;
&lt;p&gt;&lt;img alt="simple_tracker" src="assets/PuttingSpaceStationOverPhilly-c80e1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Figuring out what shape and placement for your area selection
in Simple Tracker is an art more or less. Be sure to select
an area that is completely in view for the majority of the clip.
In the above screenshot, I chose the top of two sky-scrapers that are clearly and consistently within view during the entire
clip. This helps the tracker maintain a passable tracking.&lt;/p&gt;
&lt;p&gt;Drag your compound clip of the Death Star that you made
in the previous step over to the Insert Layer section, and
then adjust the X, Y offsets and scale until the image placement
in your video looks satisfactory.&lt;/p&gt;
&lt;p&gt;In the timeline, move to the start of the
video, and after you set your tracking shape selection,
click on the &lt;em&gt;Track forward&lt;/em&gt; button (white sideways arrow
with the T in it). The plugin will iterate through each
frame attempting to track the camera location in
such a way that it can superimpose an image of the Death
Star on the sky so that it appears as if it is stationary
relative to the camera. In the resulting video (above)
you can see, if you look closely enough, some flaws, but
for the relatively small time put into it, the effect
is quite good.&lt;/p&gt;
&lt;h2&gt;Tutorial Video&lt;/h2&gt;
&lt;p&gt;Finally, here is a quick how-to video walking you
through the process in real-time:&lt;/p&gt;
&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/se17wSZzKB8" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;

&lt;h2&gt;Further references&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=bfhRtd1z2PY"&gt;Another example of this plugin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=NYfMugEz2zA"&gt;Using Adobe to create this effect&lt;/a&gt;&lt;/p&gt;</summary><category term="Film"></category><category term="Final Cut Pro"></category><category term="Special Effects"></category><category term="MacBook"></category></entry><entry><title>Using Docker-Sparker to get a quick out-of-the-box Cloud9 IDE/Jupyter/Spark/Pandas/etc. experience</title><link href="http://3implieschaos.org/using-docker-sparker-to-get-a-quick-out-of-the-box-cloud9-idejupytersparkpandasetc-experience.html" rel="alternate"></link><published>2017-02-04T23:27:00-05:00</published><updated>2017-02-04T23:27:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2017-02-04:using-docker-sparker-to-get-a-quick-out-of-the-box-cloud9-idejupytersparkpandasetc-experience.html</id><summary type="html">&lt;h3&gt;Background&lt;/h3&gt;
&lt;p&gt;Jupiter notebooks (iPython notebooks) is a
convenient and powerful tools for research.
Setting up an entire workstation with all
the right packages, and extras such as Spark,
can be a steep hill to climb. This entry
shows you how to use docker-sparker to
quickly get a workstation up and running
so that you can focus on the more interesting
task of research. This workstation will come packed
With many great Python tools and a Cloud 9 IDE interface.&lt;/p&gt;
&lt;h3&gt;Getting up and running&lt;/h3&gt;
&lt;h4&gt;Quick overview&lt;/h4&gt;
&lt;p&gt;First you will need to &lt;a href="https://docs.docker.com/engine/installation/"&gt;install Docker&lt;/a&gt;
on your workstation. That is pretty easy to do.
You will also need to &lt;a href="https://docs.docker.com/compose/install/"&gt;install docker-compose&lt;/a&gt;.
I would highly recommend you install docker-compose
from the official installation instructions &lt;a href="https://docs.docker.com/compose/install/"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If this is good enough to get you started, then you can
skip the next section.&lt;/p&gt;
&lt;h4&gt;Working remote-install example: Google Compute Engine&lt;/h4&gt;
&lt;p&gt;In this example we will demonstrate how to install
Docker on a Google cloud VM. We will take it step by step.
We will create a Linux VM in Google's Compute Engine cloud,
run the docker-sparker container on it, and use ssh tunnel
to securely connect to our notebook. The result will be that
can do powerful computations on light laptops, e.g. the
Macbook 12" by treating your workstation as a front end
interface for your more powerful backend server which is
hosted in the cloud.&lt;/p&gt;
&lt;h5&gt;Starting your VM&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;Warning! If you follow these steps, you will get a charge from Google, launching a virtual machine in Google's cloud is a paid service. You can use docker-sparker without paying, of course, if your laptop is powerful enough (you have 2gb of RAM free).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Navigate to the &lt;a href="https://cloud.google.com/compute/"&gt;Google Compute Engine Console&lt;/a&gt;. You'll want to
be logged into your Google Account. The VM you launch
will be tied to your Google Account such that you can ssh
into it from your webrowser by being logged into your account.&lt;/li&gt;
&lt;li&gt;Click on "View My Console" (you may have to go through some sign up processes first).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="view console" src="assets/JupyterHowTo-a9b80.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Select "Create Instance":&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="create instance" src="assets/JupyterHowTo-876fe.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In the next menu, you can customize what size of VM you'd like:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="view console" src="assets/JupyterHowTo-4ac03.png" /&gt;&lt;/p&gt;
&lt;p&gt;The great thing here is that Google will give you a price
estimate so you can select various configurations of vCPU/RAM.
For this project, two CPUs should be enough for many purposes.
It is vCPU that drives the cost, and you can customize and
increase the RAM size without greatly increasing the cost.
* The default disk size of 10GB and standard disk is not
recommended, I'd suggest upgrading to 15GB SSD if you
anticipate having larger data sets. Click on the "change"
button in the Boot disk section and select Ubuntu 16.04
and change the disk type to SSD and the size to what you
feel will work best for you:&lt;/p&gt;
&lt;p&gt;&lt;img alt="disk size" src="assets/JupyterHowTo-b5163.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Finally, hit create to create your new VM. The meter starts
running and your billing will begin.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="select create" src="assets/JupyterHowTo-fa523.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You will be taken to a VM dashboard:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="vm menu" src="assets/JupyterHowTo-8cfa1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Click on SSH and a window will pop up with a built-in ssh
terminal:&lt;/p&gt;
&lt;p&gt;&lt;img alt="ssh terminal" src="assets/JupyterHowTo-1d081.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Now we can install Docker! First, let's update our
system:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get update
sudo apt-get upgrade
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Next follow the official Docker advised steps to install
Docker in Ubuntu 16.04: &lt;a href="https://docs.docker.com/engine/installation/linux/ubuntu/"&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;And then for Docker compose: &lt;a href="https://docs.docker.com/compose/install/"&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We are ready to join the main instructions for installing docker-sparker, but first a note about connecting to your Cloud 9 IDE and Jupyter notebook from your cloud VM. You can do this in two ways. You can manipulate the firewall for your VM
and allow ports 9999 and 18888 to be open to your IP address.
If you share your IP address with others, I do not suggest
you go that route. The alternative is to SSH tunnel into
your instance to allow a secure connection. If you are on a
Linux or Mac workstation, you are in great luck and ssh
is easy to get access to. If you are using Windows, you'll
need to install an SSH client of your choice or if you have
Windows 10 Pro, Linux Userspace for Windows is an option for
ssh out of the box.&lt;/p&gt;
&lt;p&gt;Opening a terminal, you would create a key pair, if you don't
already have one:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh-keygen -t rsa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and follow those prompts. You will then want to copy the
contents of your public key (you can easily see that from
the comand line by running &lt;code&gt;cat ~/.ssh/id_rsa.pub&lt;/code&gt;) and
place that inside a file on the VM server located at
&lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="authorized keys" src="assets/JupyterHowTo-b2eaa.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nano ~/.ssh/authorized_keys&lt;/code&gt; and scroll down to the
bottom to make a new line and paste your &lt;code&gt;id_rsa.pub&lt;/code&gt;
contents and then &lt;code&gt;Cntrl-x&lt;/code&gt; to save. One last thing
before we are ready to go: get the ip address of your
VM. This is not going to be guaranteed to be static
unless you pay a little extra for a static IP, but you'll
find that it doesn't change very much. From the VM ssh
window run &lt;code&gt;curl ifconfig.io&lt;/code&gt; and that is your new IP.
Let's say your IP is 8.8.8.8 (it own't be but just for
the sake of the walkthrough we will pretend it is).
Then, from you workstation, launch a tunnel into your VM&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="mi"&gt;9999&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9999&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="mi"&gt;18888&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18888&lt;/span&gt; &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="mf"&gt;@8.8.8.8&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;where username is the username of your workstation that
can be found on the left of the &lt;code&gt;@&lt;/code&gt; symbol in your ssh
window command prompt line (the part blurred below):&lt;/p&gt;
&lt;p&gt;&lt;img alt="get username" src="assets/JupyterHowTo-b1678.png" /&gt;&lt;/p&gt;
&lt;p&gt;What this does is &lt;em&gt;tunnel&lt;/em&gt; the ports that docker-sparker will
be using to serve Cloud 9 IDE (9999) and Jupyter notebook
(18888) through your SSH connection such that you can access
the ports at &lt;em&gt;localhost&lt;/em&gt; rather than remotely. That is,
instead of pointing your browser at:&lt;/p&gt;
&lt;p&gt;&lt;a href=""&gt;http://YOUR.VM.IP:18888&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;you will point to&lt;/p&gt;
&lt;p&gt;&lt;a href="http://localhost:18888"&gt;http://localhost:18888&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;which will point to the port tunneled locally.&lt;/p&gt;
&lt;h4&gt;Getting docker-sparker up and running&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Install git on the machine you want to be running
docker-sparker on. On a linux machine:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install git
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Clone the docker-sparker repo:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone https://github.com/doctimjones/docker-sparker.git
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Move into the workstation directory:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cd docker-sparker/workstation-container
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Modify the &lt;code&gt;docker-compose.yaml&lt;/code&gt; file as you'd like,
in particular, you'll want to point it to a workspace.
If you use the default, create a &lt;code&gt;scratch&lt;/code&gt; folder
(&lt;code&gt;mdkir ~/scratch&lt;/code&gt;):&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;version: &amp;#39;2&amp;#39;
services:
  workstation:
    build:
      context: ../workstation-container/
    ports:
     - &amp;quot;127.0.0.1:9999:9999&amp;quot;
     - &amp;quot;127.0.0.1:18888:8888&amp;quot;
    depends_on:
     - spark-base
    image: workstation-container
    volumes:
     - $HOME/scratch:/usr/local/develop
     - $HOME/.ssh:/root/.ssh
     - $HOME/.aws:/root/.aws
     - $HOME/.config:/root/.config
     - $HOME/.gitconfig:/root/.gitconfig
  spark-base:
    build:
      context: ../base-container/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are using an ssh tunnel to connect or running it on
your local workstation, the ports configuration in the above
yaml works fine; if you are going to be connecting remotely
and opening firewall ports, then remove the "127.0.0.1:"
prefix on the ports entries.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Docker and UFW warning: If you are using UFW to set your
firewall on your machine on Ubuntu 16.04, Docker will override
UFW and leave ports 9999 and 18888 open to the world even if you
block them with UFW. You can fix this behavior by creating
the file &lt;code&gt;/etc/docker/daemon.json&lt;/code&gt; with contents &lt;code&gt;{
    "iptables": false
}&lt;/code&gt; and restarting Docker and UFW.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Run &lt;code&gt;docker-compose up -d&lt;/code&gt;. This will take quite a bit of time
to build, possibly up to an hour or more depending on your system
capacity.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once it has successfully built the containers and started them,
you can now access your Cloud 9 IDE at:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://localhost:9999"&gt;http://localhost:9999&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;and your Jupyter notebook at&lt;/p&gt;
&lt;p&gt;&lt;a href="http://localhost:18888"&gt;http://localhost:18888&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you are using a remote host, simply replace &lt;code&gt;localhost&lt;/code&gt; in
the links above with that hosts FQDN or IP Address.&lt;/p&gt;
&lt;p&gt;You should see a Cloud 9 IDE at &lt;a href="http://localhost:9999"&gt;http://localhost:9999&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="cloud9" src="assets/JupyterHowTo-33389.png" /&gt;&lt;/p&gt;
&lt;p&gt;and a Jupyter notebook at &lt;a href="http://localhost:18888"&gt;http://localhost:18888&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="jupyter" src="assets/JupyterHowTo-22dfd.png" /&gt;&lt;/p&gt;
&lt;p&gt;Now do some great development and research!&lt;/p&gt;</summary><category term="DevOps"></category><category term="Python"></category><category term="Data Science"></category><category term="Docker"></category><category term="Spark"></category><category term="Cloud 9 IDE"></category><category term="Jupyter"></category><category term="Pandas"></category><category term="Google Compute"></category><category term="SSH"></category></entry><entry><title>AWS Virtual Machines, cook thyself! Part I</title><link href="http://3implieschaos.org/aws-virtual-machines-cook-thyself-part-i.html" rel="alternate"></link><published>2017-01-28T17:00:00-05:00</published><updated>2017-01-28T17:00:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2017-01-28:aws-virtual-machines-cook-thyself-part-i.html</id><summary type="html">&lt;h3&gt;Motivation&lt;/h3&gt;
&lt;p&gt;Cloudformation offers a nice solution to orchestrating infrastructure deployment, but has its limitations. Its built in method for deployment scripts, "User Data", is difficult to maintain and unwieldy for more complicated systems. This walkthrough tutorial shows you how you can use chef, AWS KMS, and AWS Cloudformation together to get the best of both worlds--full automation with Cloudformation coupled with Chef's configuration management. &lt;/p&gt;
&lt;p&gt;In Part I, we create a chef cookbook to install the Cloud 9 IDE development package on a server.&lt;/p&gt;
&lt;p&gt;In Part II, we do the same thing using Puppet.&lt;/p&gt;
&lt;p&gt;In Part III, we demonstrate how to use Cloudformation to have boxes spin up in AWS and automatically cook themselves using either of these provisioning methods.&lt;/p&gt;
&lt;h5&gt;(why not use Opsworks instead)?&lt;/h5&gt;
&lt;p&gt;Opsworks is limiting in some ways that many, including myself, feel does not permit the full use of Chef. This solution cuts out Opsworks as the middle-man, so to speak, and leverages the full power of chef-solo automatically.&lt;/p&gt;
&lt;h2&gt;Part I: Quick Chef Walkthrough&lt;/h2&gt;
&lt;h3&gt;Yet another chef tutorial&lt;/h3&gt;
&lt;p&gt;You can of course skip this step if you are familiar with Chef to a great enough degree, but in the spirit of making this a self-contained walkthrough, we will start from the ground up.&lt;/p&gt;
&lt;h4&gt;Getting started&lt;/h4&gt;
&lt;h5&gt;Installing ChefDK&lt;/h5&gt;
&lt;p&gt;It is widely considered best practice to use &lt;a href="https://downloads.chef.io/chefdk"&gt;ChefDK&lt;/a&gt;, and this walkthrough uses ChefDK exclusively.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;On Mac, install &lt;a href="http://brew.sh/"&gt;HomeBrew&lt;/a&gt; and run &lt;code&gt;brew cask install chefdk&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On Linux, &lt;a href="https://downloads.chef.io/chefdk"&gt;download a package&lt;/a&gt; corresponding to your distro and install accordingly.&lt;/li&gt;
&lt;li&gt;On Windows: Run Linux as a Virtual Machine, get Docker for Windows, or &lt;em&gt;try&lt;/em&gt; using Bash on Windows, but this walkthrough doesn't support Windows-based development. &lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Initiating your cookbook&lt;/h5&gt;
&lt;p&gt;Let's start with the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chef generate cookbook c9_ide_chef
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This command generates a template for a cookbook. Note that we use and underline in the name instead of a hyphen as hyphens can be problematic for chef in some circumstances. We now have a folder with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;├── .gitignore
├── .kitchen.yml
├── Berksfile
├── README.md
├── chefignore
├── metadata.rb
├── recipes
│   └── default.rb
├── spec
│   ├── spec_helper.rb
│   └── unit
│       └── recipes
│           └── default_spec.rb
└── test
    └── smoke
        └── default
            └── default_test.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It also  creates a &lt;code&gt;.delivery&lt;/code&gt; and a &lt;code&gt;.git&lt;/code&gt; folder whose contents are omitted here for clarity. &lt;/p&gt;
&lt;p&gt;The second command creates an attribute folder which we can populate with default attributes for our cookbook, and the third line creates a default template for a "message of the day" to be displayed when first logging in. &lt;/p&gt;
&lt;p&gt;The &lt;code&gt;.git&lt;/code&gt; directory is useful and we will use it as the basis for a new repo in github repo. &lt;/p&gt;
&lt;h5&gt;Pushing to GitHub&lt;/h5&gt;
&lt;p&gt;Now that we have the skeleton for our cookbook, we should start pushing to GitHub for version-control. On GitHub, create a public repo called c9_ide. Then run the following commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git add .
git commit -m &amp;quot;First commit&amp;quot;
git remote add origin git@github.com:YOUR_GITHUB_USERNAME/c9_ide_chef.git
git push -u origin master
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now the stage is set and we are ready to make the cookbook actually do something.&lt;/p&gt;
&lt;h4&gt;Create the core configuration&lt;/h4&gt;
&lt;h5&gt;Creating a story for the cookbook&lt;/h5&gt;
&lt;p&gt;So far we've seen how to set up the cookbook, but we don't quite know what we are going to do with it. Now is a good time to set up some goals for our cookbook:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It should update all packages before doing anything else&lt;/li&gt;
&lt;li&gt;It should create a message of the day that gives basic information about the server to a user logging in&lt;/li&gt;
&lt;li&gt;It should install basic security packages and other utilities&lt;/li&gt;
&lt;li&gt;It should install the packages needed to run Cloud 9 IDE&lt;/li&gt;
&lt;li&gt;It should pull and install Cloud 9 IDE&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Updating all packages&lt;/h6&gt;
&lt;p&gt;Just for fun, we are going to make our cookbook work for both Debian and RHEL variations of Linux. Under the recipes folder, let's create a recipe file called &lt;code&gt;update.rb&lt;/code&gt; and give it contents:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# Update system to start with
case node[&amp;#39;platform&amp;#39;]


when &amp;#39;debian&amp;#39;, &amp;#39;ubuntu&amp;#39;

    execute &amp;#39;AptUpdateUpgrade&amp;#39; do
        command &amp;quot;apt-get update &amp;amp;&amp;amp; DEBIAN_FRONTEND=noninteractive apt-get upgrade -y&amp;quot;
    end

when &amp;#39;redhat&amp;#39;, &amp;#39;centos&amp;#39;, &amp;#39;fedora&amp;#39;

     # Update all packages
    execute &amp;#39;UpdateYum&amp;#39; do
        command &amp;quot;yum -y update&amp;quot;
    end

    # Add Fedora&amp;#39;s Extra Packages for Enterprise Linux
    execute &amp;#39;GetEPELRepo&amp;#39; do
        command &amp;quot;rpm -iUvh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-9.noarch.rpm&amp;quot;
        not_if &amp;quot;rpm -qa | grep -qx &amp;#39;epel-release-7-9.noarch&amp;#39;&amp;quot;
    end

end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;in the &lt;code&gt;default.rb&lt;/code&gt; recipe, add the line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;include_recipe &amp;#39;c9_ide::update&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That's it for now! Before we go any further, let's test this. Chef has automatically added some basis for testing to your repo. Let's start with kitchen. This assumes you have &lt;a href="https://www.virtualbox.org/wiki/Downloads"&gt;VirtualBox&lt;/a&gt; and &lt;a href="https://www.vagrantup.com/"&gt;Vagrant&lt;/a&gt; installed (if you don't, install them). At the base directory, run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kitchen create
kitchen converge
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The first command creates the virtual machines for us to work with, and teh second command cooks Chef inside of them. It is a very convenient way to do a full test of your code before pushing to github. The converge command may take quite a while as we are updating all packages on the systems and doing it for two VMs, and Ubuntu one and a CentOS one. If all goes well, the final output looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Chef Client finished, 1/1 resources updated in 02 minutes 21 seconds
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Creating a C9 User&lt;/h6&gt;
&lt;p&gt;It is rarely a good idea to run a program as root. As such, our next step is to create a user for running the Cloud 9 IDE. We start by creating a data bag. First, install knife-solo and &lt;a href="https://github.com/thbishop/knife-solo_data_bag"&gt;knife-solo data bag&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chef gem install knife-solo
chef gem install knife-solo_data_bag
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This is not entirely necessary, but that tool can be useful in other ways for making chef solo cookbooks. Then we can generate a databag and databag item:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir data_bags
export EDITOR=&amp;quot;vi&amp;quot;
knife solo data bag create users c9ide
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In the editor that pops up, paste the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;{
  &amp;quot;id&amp;quot;: &amp;quot;c9ide&amp;quot;,
  &amp;quot;comment&amp;quot;: &amp;quot;c9ide User&amp;quot;,
  &amp;quot;ssh_keys&amp;quot;: [
    &amp;quot;&amp;quot;
  ],
  &amp;quot;home&amp;quot;: &amp;quot;/home/c9ide&amp;quot;,
  &amp;quot;ssh_keygen&amp;quot;: false
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Next, back to &lt;code&gt;recipe/default.rb&lt;/code&gt;, we can invoke the external chef recipe "users" to have this user installed on our system:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;include_recipe &amp;#39;user::data_bag&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To create an attributes file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chef generate attribute default
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and in &lt;code&gt;attributes/default.rb&lt;/code&gt; add the line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;default[&amp;#39;users&amp;#39;] = &amp;#39;c9ide&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This of course shows the fantastic power and utility of Chef since we can call upon a wide range of libraries already created by the chef community. Now we need to tell Chef that we are using an external library, so in our &lt;code&gt;metadata.rb&lt;/code&gt; file at the top level we add the line at the end:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;depends          &amp;#39;user&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;At the same level there is a Berksfile with the content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;source &amp;#39;https://supermarket.chef.io&amp;#39;

metadata
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;which tells chef to check this &lt;code&gt;metadata.rb&lt;/code&gt; file for dependencies (such as the user dependency we just added) that we need to pull and make available during cooking. We'll show how this is done manually a bit later, but for now &lt;code&gt;kitchen converge&lt;/code&gt; takes care of that.&lt;/p&gt;
&lt;p&gt;Now run &lt;code&gt;kitchen converge&lt;/code&gt; one more time, and you should see that the user is created. &lt;/p&gt;
&lt;p&gt;Let's create a quick smoke test item, add:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;describe user(&amp;#39;c9ide&amp;#39;) do
    it { should exist }
end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;to &lt;code&gt;test/default/default_test.rb&lt;/code&gt; and run &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kitchen verify
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;if all went well you will see:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; User c9ide
     ✔  should exist
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now is a good time to push to github:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git add .
git commit -m &amp;quot;Adds update and users&amp;quot;
git push origin master
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Installing MOTD&lt;/h6&gt;
&lt;p&gt;First, let's generate a blank template file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chef generate template motd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;fill with content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;motd-attributes&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;message&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;The hostname of this node is &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;hostname&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;The IP address of this node is &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ipaddress&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and create a recipe file &lt;code&gt;recipes/motd.rb&lt;/code&gt; with contents:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;template &amp;#39;/etc/motd&amp;#39; do
      source &amp;#39;motd.erb&amp;#39;
      mode &amp;#39;0644&amp;#39;
end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and finally add this line to the &lt;code&gt;attributes/default.rb&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;default[&amp;#39;motd-attributes&amp;#39;][&amp;#39;message&amp;#39;] = &amp;quot;A Cloud 9 IDE server&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We add the following tests at &lt;code&gt;test/smoke/default/motd_test.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;describe directory(&amp;#39;/etc/motd&amp;#39;) do  # describe this directory
    its(:content) { should match /A Cloud 9 IDE server/ }
end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We run &lt;code&gt;kitchen converge&lt;/code&gt; and &lt;code&gt;kitchen verify&lt;/code&gt; again to make sure the recipe is fine, and then push to github as before.&lt;/p&gt;
&lt;h6&gt;Installing Packages&lt;/h6&gt;
&lt;p&gt;We are getting close to installing the Cloud9 IDE. Before doing so, we need to install some packages. Some of these packages are for security purposes, or convenience in administration, while others are needed for the Cloud 9 IDE system.&lt;/p&gt;
&lt;p&gt;Create a file &lt;code&gt;recipe/packages.rb&lt;/code&gt; with content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;case node[&amp;#39;platform&amp;#39;]
when &amp;#39;debian&amp;#39;, &amp;#39;ubuntu&amp;#39;

    req_packages = [&amp;#39;fail2ban&amp;#39;,
                    &amp;#39;gcc&amp;#39;,
                    &amp;#39;g++&amp;#39;,
                    &amp;#39;git&amp;#39;,
                    &amp;#39;htop&amp;#39;,
                    &amp;#39;make&amp;#39;,
                    &amp;#39;nodejs&amp;#39;,
                    &amp;#39;nmap&amp;#39;,
                    &amp;#39;npm&amp;#39;,
                    &amp;#39;sysstat&amp;#39;,
                    &amp;#39;unattended-upgrades&amp;#39;,
                    &amp;#39;apt-listchanges&amp;#39;]

    req_packages.each do |packs|
      Chef::Log.info(&amp;quot;Installing: &amp;quot; + packs)
      package packs do
        action :install
      end
    end

    template &amp;#39;/etc/apt/apt.conf.d/50unattended-upgrades&amp;#39; do
        owner &amp;#39;root&amp;#39;
        group &amp;#39;root&amp;#39;
        mode &amp;#39;0644&amp;#39;
        source &amp;#39;50unattended-upgrades.erb&amp;#39;
    end

    template &amp;#39;/etc/apt/apt.conf.d/20auto-upgrades&amp;#39; do
        owner &amp;#39;root&amp;#39;
        group &amp;#39;root&amp;#39;
        mode &amp;#39;0644&amp;#39;
        source &amp;#39;20auto-upgrades.erb&amp;#39;
    end

when &amp;#39;redhat&amp;#39;, &amp;#39;centos&amp;#39;, &amp;#39;fedora&amp;#39;

    req_packages = [&amp;#39;fail2ban&amp;#39;,
                    &amp;#39;gcc-c++&amp;#39;,
                    &amp;#39;git&amp;#39;,
                    &amp;#39;glibc-static&amp;#39;,
                    &amp;#39;htop&amp;#39;,
                    &amp;#39;make&amp;#39;,
                    &amp;#39;nodejs&amp;#39;,
                    &amp;#39;nmap&amp;#39;,
                    &amp;#39;npm&amp;#39;,
                    &amp;#39;sysstat&amp;#39;,
                    &amp;#39;yum-cron&amp;#39;]

    req_packages.each do |packs|
      Chef::Log.info(&amp;quot;Installing: &amp;quot; + packs)
      package packs do
        action :install
      end
    end

    template &amp;#39;/etc/yum/yum-cron.conf&amp;#39; do
        owner &amp;#39;root&amp;#39;
        group &amp;#39;root&amp;#39;
        mode &amp;#39;0644&amp;#39;
        source &amp;#39;yum-cron.conf.erb&amp;#39;
    end

    execute &amp;#39;systemctl enable yum-cron&amp;#39; do
    end

    execute &amp;#39;systemctl start yum-cron&amp;#39; do
    end

end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Notice that we have sneaked in automated security updates as well. For that, we require the following templates:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;templates/50unattended-upgrades.erb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;// Automatically upgrade packages from these (origin, archive) pairs&lt;/span&gt;
&lt;span class="x"&gt;Unattended-Upgrade::Allowed-Origins {&lt;/span&gt;
&lt;span class="x"&gt;  &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;origins&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;  &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;  &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;};&lt;/span&gt;

&lt;span class="x"&gt;// List of packages to not update&lt;/span&gt;
&lt;span class="x"&gt;Unattended-Upgrade::Package-Blacklist {&lt;/span&gt;
&lt;span class="x"&gt;  &amp;quot;apache2&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;  &amp;quot;nginx&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;//  &amp;quot;libc6-dev&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;//  &amp;quot;libc6-i686&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;};&lt;/span&gt;

&lt;span class="x"&gt;// Send email to this address for problems or packages upgrades&lt;/span&gt;
&lt;span class="x"&gt;// If empty or unset then no email is sent, make sure that you&lt;/span&gt;
&lt;span class="x"&gt;// have a working mail setup on your system. The package &amp;#39;mailx&amp;#39;&lt;/span&gt;
&lt;span class="x"&gt;// must be installed or anything that provides /usr/bin/mail.&lt;/span&gt;
&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;send_email&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;// &amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;Unattended-Upgrade::Mail &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;email_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;

&lt;span class="x"&gt;// Do automatic removal of new unused dependencies after the upgrade&lt;/span&gt;
&lt;span class="x"&gt;// (equivalent to apt-get autoremove)&lt;/span&gt;
&lt;span class="x"&gt;Unattended-Upgrade::Remove-Unused-Dependencies &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;auto_remove&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;

&lt;span class="x"&gt;// Automatically reboot *WITHOUT CONFIRMATION* if a&lt;/span&gt;
&lt;span class="x"&gt;// the file /var/run/reboot-required is found after the upgrade&lt;/span&gt;
&lt;span class="x"&gt;Unattended-Upgrade::Automatic-Reboot &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;auto_reboot&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;templates/20auto-upgrades.erb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;APT::Periodic::Update-Package-Lists &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt;&lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;update_package_lists_interval&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;
&lt;span class="x"&gt;APT::Periodic::Unattended-Upgrade &amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt;&lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unattended-upgrades&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upgrade_interval&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and&lt;/p&gt;
&lt;p&gt;&lt;code&gt;templates/yum-cron.conf.erb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;update_cmd = security
apply_updates = yes
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;update_package_lists_interval&amp;#39;] = &amp;quot;1&amp;quot;
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;upgrade_interval&amp;#39;] = &amp;quot;1&amp;quot;
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;origins&amp;#39;] = [&amp;#39;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;distro_id&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt; &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;distro_codename&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;-security&amp;#39;]
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;send_email&amp;#39;] = false
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;email_address&amp;#39;] = &amp;quot;test@example.com&amp;quot;
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;auto_remove&amp;#39;] = false
default[&amp;#39;unattended-upgrades&amp;#39;][&amp;#39;auto_reboot&amp;#39;] = false
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and of course, our inspec test in &lt;code&gt;test/smoke/default/packages_test.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if os[:family] == &amp;#39;debian&amp;#39;
    req_packages = [&amp;#39;fail2ban&amp;#39;,
                    &amp;#39;gcc&amp;#39;,
                    &amp;#39;g++&amp;#39;,
                    &amp;#39;git&amp;#39;,
                    &amp;#39;htop&amp;#39;,
                    &amp;#39;make&amp;#39;,
                    &amp;#39;nodejs&amp;#39;,
                    &amp;#39;nmap&amp;#39;,
                    &amp;#39;npm&amp;#39;,
                    &amp;#39;sysstat&amp;#39;,
                    &amp;#39;unattended-upgrades&amp;#39;,
                    &amp;#39;apt-listchanges&amp;#39;]

    req_packages.each do |packs|
      describe package(packs) do
        it { should be_installed }
      end
    end

else

    req_packages = [&amp;#39;fail2ban&amp;#39;,
                    &amp;#39;gcc-c++&amp;#39;,
                    &amp;#39;git&amp;#39;,
                    &amp;#39;glibc-static&amp;#39;,
                    &amp;#39;htop&amp;#39;,
                    &amp;#39;make&amp;#39;,
                    &amp;#39;nodejs&amp;#39;,
                    &amp;#39;nmap&amp;#39;,
                    &amp;#39;npm&amp;#39;,
                    &amp;#39;sysstat&amp;#39;,
                    &amp;#39;yum-cron&amp;#39;]

    req_packages.each do |packs|
      describe package(packs) do
        it { should be_installed }
      end
    end
end
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Installing Cloud 9 IDE&lt;/h6&gt;
&lt;p&gt;Chef has a built-in git resource that we can use to pull the Cloud 9 IDE code.&lt;/p&gt;
&lt;p&gt;The test for this section will be rather brief:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;describe directory(&amp;#39;/home/c9ide/core/README.md&amp;#39;) do  # describe this directory
    its(:content) { should match /^Cloud9/ }
end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and the reason is that we can really verify whether or not this section succeeded in the next section on running via supervisor.&lt;/p&gt;
&lt;p&gt;The code for this section, in &lt;code&gt;/recipes/c9ide.rb&lt;/code&gt;, is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git &amp;quot;/home/c9ide/core&amp;quot; do
   repository &amp;#39;https://github.com/c9/core.git&amp;#39;
   reference &amp;#39;master&amp;#39;
   action :sync
end

case node[&amp;#39;platform&amp;#39;]
when &amp;#39;debian&amp;#39;, &amp;#39;ubuntu&amp;#39;
    bash &amp;#39;create nodejs link&amp;#39; do
        code &amp;lt;&amp;lt;-EOH
        ln -s /usr/bin/nodejs /usr/bin/node
        EOH
        not_if { ::File.exist?(&amp;#39;/usr/bin/node&amp;#39;) }
    end
end

bash &amp;#39;install_cloud9ide&amp;#39; do
   cwd &amp;#39;/home/c9ide/core/&amp;#39;
   user &amp;#39;root&amp;#39;
   code &amp;lt;&amp;lt;-EOH
     scripts/install-sdk.sh
     EOH
   environment &amp;#39;PREFIX&amp;#39; =&amp;gt; &amp;#39;/usr/local&amp;#39;
end
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Installing Supervisor&lt;/h6&gt;
&lt;p&gt;Finally, we want to leave our server running Cloud 9 IDE after provisioning it. Supervisor is a fantastic way to do so, though of course not the only way and perhaps not even the best way, but it is a convenient and production-ready solution (though this development kit version of Cloud 9 IDE is not production material and is meant for development purposes).&lt;/p&gt;
&lt;p&gt;In &lt;code&gt;recipes/supervisor.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;package &amp;#39;supervisor&amp;#39; do
    action :install
end

case node[&amp;#39;platform&amp;#39;]
when &amp;#39;debian&amp;#39;, &amp;#39;ubuntu&amp;#39;

    cookbook_file &amp;#39;/etc/supervisor/conf.d/cloud9ide.conf&amp;#39; do
      source &amp;#39;c9ide.conf&amp;#39;
      owner &amp;#39;root&amp;#39;
      group &amp;#39;root&amp;#39;
      mode &amp;#39;0755&amp;#39;
      action :create
    end

    execute &amp;#39;start supervisor&amp;#39; do
      command &amp;#39;service supervisor start&amp;#39;
    end

    execute &amp;#39;reload supervisor&amp;#39; do
      command &amp;#39;supervisorctl update&amp;#39;
    end

when &amp;#39;redhat&amp;#39;, &amp;#39;centos&amp;#39;, &amp;#39;fedora&amp;#39;

    cookbook_file &amp;#39;/etc/supervisord.d/cloud9ide.ini&amp;#39; do
      source &amp;#39;c9ide.conf&amp;#39;
      owner &amp;#39;root&amp;#39;
      group &amp;#39;root&amp;#39;
      mode &amp;#39;0755&amp;#39;
      action :create
    end

    execute &amp;#39;start supervisor&amp;#39; do
      command &amp;#39;service supervisord start&amp;#39;
    end

    execute &amp;#39;reload supervisor&amp;#39; do
      command &amp;#39;supervisorctl update&amp;#39;
    end
end
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and finally add this to the &lt;code&gt;c9ide_test.rb&lt;/code&gt; test file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;describe port(9999) do
  it { should be_listening }
end
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Putting it all together&lt;/h5&gt;
&lt;p&gt;The default recipe should now look like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;include_recipe &amp;#39;c9_ide::update&amp;#39;
include_recipe &amp;#39;user::data_bag&amp;#39;
include_recipe &amp;#39;c9_ide::motd&amp;#39;
include_recipe &amp;#39;c9_ide::packages&amp;#39;
include_recipe &amp;#39;c9_ide::cloud9ide&amp;#39;
include_recipe &amp;#39;c9_ide::supervisor&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;we run a final &lt;code&gt;kitchen converge&lt;/code&gt;; if all goes well, we follow up with a final &lt;code&gt;kitchen verify&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Starting&lt;/span&gt; &lt;span class="n"&gt;Kitchen&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v1&lt;/span&gt;&lt;span class="mf"&gt;.14.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ubuntu&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1604&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
       &lt;span class="n"&gt;Finished&lt;/span&gt; &lt;span class="n"&gt;setting&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ubuntu&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1604&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m0&lt;/span&gt;&lt;span class="mf"&gt;.00&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;
&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Verifying&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ubuntu&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1604&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
       &lt;span class="n"&gt;Loaded&lt;/span&gt;

&lt;span class="nl"&gt;Target&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="nl"&gt;ssh&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//vagrant@127.0.0.1:2222&lt;/span&gt;


  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;c9ide&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;core&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;README&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;match&lt;/span&gt; &lt;span class="o"&gt;/^&lt;/span&gt;&lt;span class="n"&gt;Cloud9&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
  &lt;span class="n"&gt;Port&lt;/span&gt; &lt;span class="mi"&gt;9999&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;listening&lt;/span&gt;
  &lt;span class="n"&gt;User&lt;/span&gt; &lt;span class="n"&gt;c9ide&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;exist&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;motd&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;match&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;Cloud&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="n"&gt;IDE&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;fail2ban&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;gcc&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;htop&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;make&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;nodejs&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;nmap&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;npm&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;sysstat&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;unattended&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;upgrades&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;listchanges&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;

&lt;span class="n"&gt;Test&lt;/span&gt; &lt;span class="nl"&gt;Summary&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt; &lt;span class="n"&gt;successful&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;failures&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;skipped&lt;/span&gt;
       &lt;span class="n"&gt;Finished&lt;/span&gt; &lt;span class="n"&gt;verifying&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ubuntu&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1604&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="mf"&gt;.28&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;
&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;centos&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;72&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
       &lt;span class="n"&gt;Finished&lt;/span&gt; &lt;span class="n"&gt;setting&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;centos&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;72&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m0&lt;/span&gt;&lt;span class="mf"&gt;.00&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;
&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Verifying&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;centos&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;72&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
       &lt;span class="n"&gt;Loaded&lt;/span&gt;

&lt;span class="nl"&gt;Target&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="nl"&gt;ssh&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//vagrant@127.0.0.1:2200&lt;/span&gt;


  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;c9ide&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;core&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;README&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;match&lt;/span&gt; &lt;span class="o"&gt;/^&lt;/span&gt;&lt;span class="n"&gt;Cloud9&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
  &lt;span class="n"&gt;Port&lt;/span&gt; &lt;span class="mi"&gt;9999&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;listening&lt;/span&gt;
  &lt;span class="n"&gt;User&lt;/span&gt; &lt;span class="n"&gt;c9ide&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;exist&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;motd&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;match&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;Cloud&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="n"&gt;IDE&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;fail2ban&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;gcc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;glibc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;htop&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;make&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;nodejs&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;nmap&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;npm&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;sysstat&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;
  &lt;span class="n"&gt;System&lt;/span&gt; &lt;span class="n"&gt;Package&lt;/span&gt;
     &lt;span class="err"&gt;✔&lt;/span&gt;  &lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt;

&lt;span class="n"&gt;Test&lt;/span&gt; &lt;span class="nl"&gt;Summary&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt; &lt;span class="n"&gt;successful&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;failures&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;skipped&lt;/span&gt;
       &lt;span class="n"&gt;Finished&lt;/span&gt; &lt;span class="n"&gt;verifying&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;centos&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;72&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m13&lt;/span&gt;&lt;span class="mf"&gt;.80&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;
&lt;span class="o"&gt;-----&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Kitchen&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;finished&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;m16&lt;/span&gt;&lt;span class="mf"&gt;.47&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Congratulations, you have a basic working chef recipe for installing Cloud 9 IDE, tested and provisioned on both major families of Linux.&lt;/p&gt;
&lt;h3&gt;Source Code&lt;/h3&gt;
&lt;p&gt;You can find the source code for this recipe on my github account &lt;a href="https://github.com/doctimjones/c9_ide_chef/tree/PartI"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Future Steps&lt;/h3&gt;
&lt;p&gt;We took some shortcuts and avoided some best practices for convenience here. Ideally we would like some unit tests and to pull in more community recipes. For example, the supervisor chef cookbook could be used here instead of dealing with that in a platform case. &lt;/p&gt;
&lt;p&gt;In the forthcoming Part II, we will use Puppet, a widely used alternative to Chef, to provision a server that runs the Cloud 9 IDE SDK as we have here with Chef.&lt;/p&gt;</summary><category term="AWS"></category><category term="Chef"></category><category term="Cloudformation"></category></entry><entry><title>Python uses operational chaining for boolean comparisons</title><link href="http://3implieschaos.org/python-uses-operational-chaining-for-boolean-comparisons.html" rel="alternate"></link><published>2017-01-20T18:23:00-05:00</published><updated>2017-01-20T18:23:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2017-01-20:python-uses-operational-chaining-for-boolean-comparisons.html</id><summary type="html">&lt;h4&gt;A Python feature?&lt;/h4&gt;
&lt;p&gt;A colleague noticed this behavior:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; &amp;#39;a&amp;#39; in &amp;#39;b&amp;#39; == 0
False
&amp;gt;&amp;gt;&amp;gt; (&amp;#39;a&amp;#39; in &amp;#39;b&amp;#39;) == 0
True
&amp;gt;&amp;gt;&amp;gt; &amp;#39;a&amp;#39; in (&amp;#39;b&amp;#39; == 0)
TypeError: argument of type &amp;#39;bool&amp;#39; is not iterable
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;offering a bucket of doubloons to anyone who can explain it. The final case is simply a typecasting problem, but the first two cases demonstrate Python's operating chaining behavior.&lt;/p&gt;
&lt;h4&gt;Explanation&lt;/h4&gt;
&lt;h5&gt;Using the Dis Module to dig deeper&lt;/h5&gt;
&lt;p&gt;Using the dis module, we find:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;#39;a&amp;#39; in &amp;#39;b&amp;#39; == 0

  7           0 LOAD_CONST               1 (&amp;#39;a&amp;#39;)
              3 LOAD_CONST               2 (&amp;#39;b&amp;#39;)
              6 DUP_TOP
              7 ROT_THREE
              8 COMPARE_OP               6 (in)
             11 JUMP_IF_FALSE_OR_POP    21
             14 LOAD_CONST               3 (0)
             17 COMPARE_OP               2 (==)
             20 RETURN_VALUE
        &amp;gt;&amp;gt;   21 ROT_TWO
             22 POP_TOP
             23 RETURN_VALUE

&amp;#39;a&amp;#39; in &amp;#39;b&amp;#39; and &amp;#39;b&amp;#39; == 0
15           0 LOAD_CONST               1 (&amp;#39;a&amp;#39;)
              3 LOAD_CONST               2 (&amp;#39;b&amp;#39;)
              6 COMPARE_OP               6 (in)
              9 JUMP_IF_FALSE_OR_POP    21
             12 LOAD_CONST               2 (&amp;#39;b&amp;#39;)
             15 LOAD_CONST               3 (0)
             18 COMPARE_OP               2 (==)
        &amp;gt;&amp;gt;   21 RETURN_VALUE

&amp;#39;a&amp;#39; in &amp;#39;a&amp;#39; == 0
  9           0 LOAD_CONST               1 (&amp;#39;a&amp;#39;)
              3 LOAD_CONST               1 (&amp;#39;a&amp;#39;)
              6 DUP_TOP
              7 ROT_THREE
              8 COMPARE_OP               6 (in)
             11 JUMP_IF_FALSE_OR_POP    21
             14 LOAD_CONST               2 (0)
             17 COMPARE_OP               2 (==)
             20 RETURN_VALUE
        &amp;gt;&amp;gt;   21 ROT_TWO
             22 POP_TOP
             23 RETURN_VALUE
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;In words&lt;/h5&gt;
&lt;p&gt;Parenthesis essential forces Python to do 'something' first before doing anything else. I often use parenthesis out of habit even when not needed just to be 100% clear. The above behavior shows where that habit might come in handy if Python's operation chaining isn't the desired behavior. When we put &lt;code&gt;'a' in 'b'&lt;/code&gt; inside parenthesis, Python is forced to evaluate that independently of the rest of line; this evaluates to &lt;code&gt;True&lt;/code&gt; or &lt;code&gt;False&lt;/code&gt;, and then the &lt;code&gt;== 0&lt;/code&gt; comparison acts as a Boolean comparison, giving expected behavior since Python sees False and 0 as equivalent here.&lt;/p&gt;
&lt;p&gt;In the first instance above, however, Python is operator chaining. For &lt;code&gt;'a' in 'b' == 0&lt;/code&gt;, it first loads a and b strings such that the stack is&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[ b, a ]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;it then &lt;code&gt;DUP_TOP&lt;/code&gt; duplicates &lt;code&gt;b&lt;/code&gt; so that it doesn’t have to waste time to load it again for the second evaluation, resulting in the stack:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[ b, b, a ]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;ROT_THREE&lt;/code&gt; lifts second and third stack item up and the top item down to third place, so now the stack is: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[ b, a, b ]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;COMPARE_OP&lt;/code&gt; acts on &lt;code&gt;[ b, a]&lt;/code&gt;, and since it is not true, &lt;code&gt;JUMP_IF_FALSE_OR_POP&lt;/code&gt; forces it to jump and just returns False. This makes sense because it
sees this as a compound AND statement, and when the first part of an AND statement is false, the entire thing is false and it is a waste of
resources to compute further. &lt;/p&gt;
&lt;p&gt;What is interesting is if you do &lt;code&gt;'a' in 'a' == 1&lt;/code&gt;,  or &lt;code&gt;'a' in 'a' == 0&lt;/code&gt;. Take the former, for example, 
which after &lt;code&gt;DUP_TOP&lt;/code&gt; gives us the stack:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[ a, a, a ]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here &lt;code&gt;'a' in 'a'&lt;/code&gt; is obviously true, and these two entries of the stack are replaced with the result of that evaluation, which is &lt;code&gt;True&lt;/code&gt;. This, now being the top of the stack, is popped off by &lt;code&gt;JUMP_IF_FALSE_OR_POP&lt;/code&gt; 
leaving the duplicated 'a' on the top of the stack, where then &lt;code&gt;1&lt;/code&gt; is loaded for the next comparison, so the stack is now:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[1, a]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and the &lt;code&gt;==&lt;/code&gt; comparison is applied which is indeed False. 
Thus &lt;code&gt;'a' in 'a' == 0&lt;/code&gt; is chained as &lt;code&gt;'a' in 'a' and 'a' == 0&lt;/code&gt; and will also be false. Similarly, &lt;code&gt;'a' in 'b' == 0&lt;/code&gt; is effectively the same as &lt;code&gt;'a' in 'b' and 'b' == 0&lt;/code&gt; which is false.&lt;/p&gt;
&lt;p&gt;The following behavior, then, makes sense:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; &amp;#39;a&amp;#39; in &amp;#39;a&amp;#39;
True
&amp;gt;&amp;gt;&amp;gt; &amp;#39;a&amp;#39; in &amp;#39;a&amp;#39; and &amp;#39;a&amp;#39; == True
False
&amp;gt;&amp;gt;&amp;gt; &amp;#39;a&amp;#39; in &amp;#39;a&amp;#39; == True
False
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Python"></category></entry><entry><title>Abstracting Networking with Docker Containers</title><link href="http://3implieschaos.org/abstracting-networking-with-docker-containers.html" rel="alternate"></link><published>2016-03-03T00:23:00-05:00</published><updated>2016-03-03T00:23:00-05:00</updated><author><name>Tim Jones</name></author><id>tag:3implieschaos.org,2016-03-03:abstracting-networking-with-docker-containers.html</id><summary type="html">&lt;h4&gt;Goal&lt;/h4&gt;
&lt;p&gt;Network Namespace is a Linux tool that allows for the easy virtualization of network models. While it has plenty of &lt;a href="http://blog.scottlowe.org/2013/09/04/introducing-linux-network-namespaces/"&gt;practical uses directly on the hardware&lt;/a&gt;, this will be a quick introduction to how it can be used to create more complex Docker networks that could be extended to modeling, say, the infrastructure of a data center or cloud provider.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/brandon-rhodes/fopnp/tree/m/playground"&gt;Brandon Rhodes created&lt;/a&gt; a great "playground" for his book &lt;a href="https://github.com/brandon-rhodes/fopnp"&gt;Foundations of Python Network Programming&lt;/a&gt;. Inspired by this example, we will create a small simple netns/docker example that is more bite-sized for those who aren't familiar with these tools. &lt;/p&gt;
&lt;h4&gt;What is NetNS?&lt;/h4&gt;
&lt;p&gt;Very briefly, netns is a tool that allows us to create virtual network namespaces that are isolated from each other. &lt;/p&gt;
&lt;p&gt;Let's let its man page speak for itself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A network namespace is logically another copy of the network stack, with its own routes, firewall rules, and network devices.&lt;/p&gt;
&lt;p&gt;By default a process inherits its network namespace from its parent.Initially all the processes share the same default network namespace from the init process.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;One's imagination can fly away at this point thinking of the multitude of possibilities this offers for security, but that should be a focus of a separate entry.&lt;/p&gt;
&lt;p&gt;Creating a new namespace, here let's call it newtonsapple for the sake of example, is as easy as &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip netns add newtonsapple
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Of course there is much, much more to it than that, but we will see more details about what netns can do below.&lt;/p&gt;
&lt;h4&gt;What is Docker?&lt;/h4&gt;
&lt;p&gt;Chances are pretty high that if you found this page, you have a pretty good idea of what Docker is. I will put it in the context of our netns discussion. In some ways, Docker is to the OS what netns is the machine's networking configuration. Docker is a way to run processes in an isolated environment that does not use virtualization of hardware, but rather has direct access to the hardware via having direct access to the kernel. There are plenty of places out there that will provide fantastic introductions to Docker, but for the sake of this entry, it helps to think of netns and Docker as sort of cousins in that they both create isolated sandboxes which can interact in controlled ways with the &lt;em&gt;real&lt;/em&gt; OS/network outside of their bubbles (in the case of Docker this bubble is called a &lt;strong&gt;container&lt;/strong&gt; and in case of netns this bubble is called a &lt;strong&gt;namespace&lt;/strong&gt;). &lt;/p&gt;
&lt;h6&gt;Docker Networking&lt;/h6&gt;
&lt;p&gt;Docker has a great &lt;a href="https://docs.docker.com/engine/userguide/networking/"&gt;tutorial on Docker Networking&lt;/a&gt; and it would be inefficient to recreate that here in any way. Instead I want to highlight the key parts that are relevant to this entry. &lt;/p&gt;
&lt;p&gt;The first thing to note is that Docker automatically creates its own network. If you do an &lt;code&gt;ifconfig&lt;/code&gt; or an &lt;code&gt;ip a&lt;/code&gt; on a machine running a Docker server, you will find an entry corresponding to this network listed in the output:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;docker0   Link encap:Ethernet  HWaddr 56:84:7a:fe:97:99  
          inet addr:172.17.42.1  Bcast:0.0.0.0  Mask:255.255.0.0
 ...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Docker also creates a network internal to each container (loopback) and you can launch a container that hooks directly in to the host network (&lt;code&gt;docker run --net=host&lt;/code&gt;). The default is to launch it on the docker0 network, though it is often useful to run it on the host network if, for example, it needs access to VPN connections and it isn't worth the effort to create further bridges. However, an interesting option is &lt;code&gt;--net=none&lt;/code&gt;. This tells Docker to not touch the networking of the container and allows us to create our own networking for the containers.&lt;/p&gt;
&lt;h4&gt;Using NetNS with Docker to Model Your Home Network&lt;/h4&gt;
&lt;h6&gt;Preliminary setup&lt;/h6&gt;
&lt;p&gt;This post will assume you are working from Ubuntu/Debian, though any Linux distribution will have these tools.&lt;/p&gt;
&lt;p&gt;On Ubuntu, you have to create a directory &lt;code&gt;/var/run/netns&lt;/code&gt; in order to use netns:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo mkdir -p /var/run/netns
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Though this wasn't my experience, you may have to enable two Linux kernel modules as well:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo modprobe ip_nat_ftp nf_conntrack_ftp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You may also need to install bridge-utils if it isn't already installed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get update
sudo apt-get install bridge-utils
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Bringing up the containers and linking netns&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;docker run --net=none --dns=8.8.8.8 --name=verizon -d ubuntu /bin/sh -c &amp;quot;while true; do echo &amp;quot;&amp;quot;; done&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;pid=$(docker inspect -f &amp;#39;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;.State.Pid&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;#39; verizon)&lt;/span&gt;
&lt;span class="x"&gt;sudo ln -s /proc/$pid/ns/net /var/run/netns/verizon&lt;/span&gt;

&lt;span class="x"&gt;docker run --net=none --dns=8.8.8.8 --name=router -d ubuntu /bin/sh -c &amp;quot;while true; do echo &amp;quot;&amp;quot;; done&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;pid=$(docker inspect -f &amp;#39;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;.State.Pid&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;#39; router)&lt;/span&gt;
&lt;span class="x"&gt;sudo ln -s /proc/$pid/ns/net /var/run/netns/router&lt;/span&gt;

&lt;span class="x"&gt;docker run --net=none --dns=8.8.8.8 --name=laptop -d ubuntu /bin/sh -c &amp;quot;while true; do echo &amp;quot;&amp;quot;; done&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;pid=$(docker inspect -f &amp;#39;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;.State.Pid&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;#39; laptop)&lt;/span&gt;
&lt;span class="x"&gt;sudo ln -s /proc/$pid/ns/net /var/run/netns/laptop&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h6&gt;Creating Network Interfaces&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@vagrant-ubuntu-trusty-64:~/code# ip netns exec verizon ip link list
1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
10: eth1: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/ether f6:8b:e9:66:00:b0 brd ff:ff:ff:ff:ff:ff
root@vagrant-ubuntu-trusty-64:~/code# ip netns exec router ip link list                                                                                        
1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
4: eth1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether 36:7a:68:d8:a5:84 brd ff:ff:ff:ff:ff:ff
9: eth0: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc pfifo_fast state DOWN mode DEFAULT group default qlen 1000
    link/ether fe:60:62:9d:1b:7b brd ff:ff:ff:ff:ff:ff
root@vagrant-ubuntu-trusty-64:~/code# ip netns exec laptop ip link list                                                                                        
1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
7: eth1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether f2:ee:9e:56:55:d4 brd ff:ff:ff:ff:ff:ff
root@vagrant-ubuntu-trusty-64:~/code# brctl show
bridge name     bridge id               STP enabled     interfaces
docker0         8000.56847afe9799       no
home            8000.821c2640a1ea       no              laptop_eth1
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;### Create network namespaces
ip netns add levela
ip netns add levelb
ip netns add levelc

### Create peer devices
ip link add veth0a type veth peer name veth1a
ip link add veth0b type veth peer name veth1b
ip link add veth0c type veth peer name veth1c

### Put these devices in namespaces
# veth0a remains in globalspace
ip link set veth1a netns levela
ip link set veth0b netns levela
ip link set veth1b netns levelb
ip link set veth0c netns levelb
ip link set veth1c netns levelc

### Set up Networks
ip netns exec levela ifconfig veth1a 172.16.1.0/24 up
ip netns exec levelb ifconfig veth1b 10.1.1.1/24 up
ip netns exec levelc ifconfig veth1c 192.168.1.1/24 up
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;At thist point we should be able to observer network namespaces and corresponding devices with their networks:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# ip netns exec levela ip addr list

1: lo: &amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state DOWN group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
6: veth1a: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether ba:8c:ec:6e:71:db brd ff:ff:ff:ff:ff:ff
    inet 172.16.1.0/24 brd 172.16.1.255 scope global veth1a
       valid_lft forever preferred_lft forever
9: veth0b: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether 82:88:3d:09:e7:1f brd ff:ff:ff:ff:ff:ff

# ip netns exec levelb ip addr list

1: lo: &amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state DOWN group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
8: veth1b: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether c2:c4:9c:2b:41:a5 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.1/24 brd 10.1.1.255 scope global veth1b
       valid_lft forever preferred_lft forever
11: veth0c: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether 96:a5:1c:5b:e3:8c brd ff:ff:ff:ff:ff:ff

# ip netns exec levelc ip addr list

1: lo: &amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state DOWN group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
10: veth1c: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether 66:d7:ff:9b:65:63 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.1/24 brd 192.168.1.255 scope global veth1c
       valid_lft forever preferred_lft forever
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and corresponding routes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# ip netns exec levela ip route list

172.16.1.0/24 dev veth1a  proto kernel  scope link  src 172.16.1.0 

# ip netns exec levelb ip route list

10.1.1.0/24 dev veth1b  proto kernel  scope link  src 10.1.1.1 

# ip netns exec levelc ip route list

192.168.1.0/24 dev veth1c  proto kernel  scope link  src 192.168.1.1 
&lt;/pre&gt;&lt;/div&gt;</summary><category term="DevOps"></category><category term="Docker"></category><category term="Linux"></category><category term="Networking"></category></entry></feed>