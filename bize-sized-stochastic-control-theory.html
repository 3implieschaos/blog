<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bize sized stochastic control theory | doctimjones</title>
  <meta charset="utf-8">
<meta name="description" content="A bite sized look at stochastic control theory"><meta name="author" content="Tim Jones">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="http://doctimjones.org/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="http://doctimjones.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://doctimjones.org/favicon.ico" type="image/x-icon">
  <link href="http://doctimjones.org/" type="application/atom+xml" rel="alternate" title="doctimjones ATOM Feed" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="http://doctimjones.org">doctimjones</a></div>
  <div class="small"></div>
    <div class="nav">
  <li><a href="http://doctimjones.org/archives/">Archive</a></li>
    </div>
    <div class="nav social">
<ul>
    <li><a href="https://twitter.com/timjonestweets">Twitter</a></li>
    <li><a href="https://www.linkedin.com/in/timothy-jones-3a60814b">Linked In</a></li>
</ul>    </div>
</div>

 <script src="/theme/css/numeric-1.2.6.min.js"></script>
<script>
  var signflow=1;
  var timez=0.0;
  var signflow3=1;
  var flag=0;
  var m1=0.8;
  var m2=0.6;
  var omega1=0.0;
  var omega2=0.0;
  var domega1;
  var domega2;
  var theta1= Math.PI/3;
  var theta2= -Math.PI/2;
  var dtheta1;
  var dtheta2;
  var pivot={x:218, y:34};
  var g=9.8;
  var L1=0.25;
  var L2=0.15;
  var x = 0;
  window.requestAnimFrame = (function(callback){
                return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function(callback){
                    window.setTimeout(callback, 1000 / 60);
                };
            })();


  function writeMessage(canvas, message){
    var context = canvas.getContext('2d');
    context.canvas.width  = window.innerWidth;
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.font = '18pt Calibri';
    context.fillStyle = 'black';
    context.fillText(message, 10, 25);
}

function getMousePos(canvas, evt){
    // get canvas position
    var obj = canvas;
    var top = 0;
    var left = 0;
    while (obj && obj.tagName != 'BODY') {
        top += obj.offsetTop;
        left += obj.offsetLeft;
        obj = obj.offsetParent;
    }




    var mouseX = evt.clientX - left + window.pageXOffset;
    var mouseY = evt.clientY - top + window.pageYOffset;
    return {
        x: mouseX,
        y: mouseY
    };
}

      function animate(myRectangle,myStar,myPlanet,mousePos,pend){

                var canvas = document.getElementById("myCanvas");
                var context = canvas.getContext("2d");
                context.canvas.width  = window.innerWidth;
                var terrain = document.getElementById("terCanvas");
                var terCtx = terrain.getContext("2d");
                terCtx.canvas.width = window.innerWidth;

              // clear
                context.clearRect(0, 0, canvas.width, canvas.height);

              //  context.fillStyle = "rgba(50,50,50,1)";
              //  context.font = "34px sans-serif";
              //  context.fillText("Timothy Jones", 5, 35);
              //  context.font = "24px sans-serif";
            //    context.fillText("Ph.D., Physics", 5, 65);
            ///    context.font = "10px sans-serif";
            //    context.fillText("Random walk, N-Body (with breaking at borders)-mouse = 3rd body", 5, 5);
               // flag=flag + 1;
               // }
                var randomnumber=Math.floor(Math.random()*3);
                var randy = randomnumber-1;
                var randomnumber2=Math.floor(Math.random()*3);
                var randy2 = randomnumber2-1;
                myRectangle.x = myRectangle.x + randy;
                myRectangle.y = myRectangle.y + randy2;

                if(myRectangle.x>canvas.width){myRectangle.x=0.0;}
                if(myRectangle.y>canvas.height){myRectangle.y=0.0;}
                if(myRectangle.x<0){myRectangle.x=canvas.width;}
                if(myRectangle.y<0){myRectangle.y=canvas.height;}


                terCtx.beginPath();
                terCtx.globalCompositeOperation='destination-over';
                terCtx.rect(myRectangle.x+100, myRectangle.y, 1, 1);
                terCtx.closePath();
                terCtx.fillStyle = "rgba(235,200,5,0.2)";
                terCtx.fill();


                //Star-Planet
                canvas.addEventListener('mousemove', function(evt){
                mousePos = getMousePos(canvas, evt);  }, false);

               if(mousePos.x > (canvas.width-40) || mousePos.x < 40 || mousePos.y > (canvas.height-10) || mousePos.y < 10){
                         mousePos.x = 400;
                         mousePos.y = 60;
                   }

                 context.beginPath();
                 context.globalCompositeOperation='lighter';
                 context.arc(myPlanet.x,myPlanet.y,3, 0, Math.PI*2, true);
                 context.fillStyle = "rgba(255,255,255,0.5)";
                 context.fill();
                 context.closePath();


                 var sprad = Math.sqrt((myStar.x-myPlanet.x)*(myStar.x-myPlanet.x) + (myStar.y-myPlanet.y)*(myStar.y-myPlanet.y));
                 var mrad = Math.sqrt((mousePos.x-myPlanet.x)*(mousePos.x-myPlanet.x) + (mousePos.y-myPlanet.y)*(mousePos.y-myPlanet.y));

                 var pnextspeedx = myPlanet.speedx + 230*(myStar.x-myPlanet.x)/( (sprad*sprad + 5)*Math.sqrt(sprad*sprad + 5)) +  260*(mousePos.x-myPlanet.x)/( (mrad*mrad + 5)*Math.sqrt(mrad*mrad + 5));
	               var pnextspeedy = myPlanet.speedy + 230*(myStar.y-myPlanet.y)/( (sprad*sprad + 5)*Math.sqrt(sprad*sprad + 5)) +  260*(mousePos.y-myPlanet.y)/( (mrad*mrad +5 )*Math.sqrt(mrad*mrad +5));

                 myPlanet.speedx =  pnextspeedx;
                 myPlanet.speedy =  pnextspeedy;

                 myPlanet.x = myPlanet.x + 0.1*pnextspeedx;
                 myPlanet.y = myPlanet.y + 0.1*pnextspeedy;

                if(myPlanet.x>canvas.width){myPlanet.x=myPlanet.x-1;myPlanet.speedx=-0.9*myPlanet.speedx;}
                if(myPlanet.y>canvas.height){myPlanet.y=myPlanet.y-1;myPlanet.speedy=-0.9*myPlanet.speedy;}
                if(myPlanet.x<0){myPlanet.x=0;myPlanet.speedx=-0.9*myPlanet.speedx;}
                if(myPlanet.y<0){myPlanet.y=0;myPlanet.speedy=-0.9*myPlanet.speedy;}

                 context.beginPath();
                 context.globalCompositeOperation='source-over';
                 context.arc(myStar.x,myStar.y,myStar.rad, 0, Math.PI*2, true);
                 context.fillStyle = "rgba(255,55,10,0.6)";
                 context.fill();
                 context.closePath();

               context.beginPath();
               context.globalCompositeOperation='source-over';
               context.arc(myPlanet.x,myPlanet.y,2, 0, Math.PI*2, true);
               context.fillStyle = "rgba(0,255,0,1)";
               context.fill();
               context.closePath();

                terCtx.beginPath();
                terCtx.globalCompositeOperation='destination-over';
                terCtx.arc(myPlanet.x,myPlanet.y,2, 0, Math.PI*2, true);
                terCtx.closePath();
                terCtx.fillStyle = "rgba(215,255,255,0.4)";
                terCtx.fill();

                 context.beginPath();
                 context.globalCompositeOperation='source-over';
                 context.arc(mousePos.x,mousePos.y,7, 0, Math.PI*2, true);
                 context.fillStyle = "rgba(0,0,255,0.6)";
                 context.fill();
                 context.closePath();


                // Double pendulum


                // var pend = { j1x: 230, j1y: 45, j1vx:0, j1vy:-1, j2x: 220, j2vx:0, j2y:65, j2vy:0};


                 f = function(t,x) {
          return [x[2],x[3],-g*(2*m1+m2)*Math.sin(x[0])-m2*g*Math.sin(x[0]-2*x[1])-2*Math.sin(x[0]-x[1])*m2*(x[3]*x[3]*L2 + x[2]*x[2]*L1*Math.cos(x[0]-x[1]))/(  L1*(2*m1 +m2 -m2*Math.cos(2*x[0] - 2*x[1]))),
             2*Math.sin(x[0]-x[1])*(x[2]*x[2]*L1*(m1+m2)+g*(m1+m2)*Math.cos(x[0])+x[3]*x[3]*L2*m2*Math.cos(x[0]-x[1]))/(  L2*(2*m1 +m2 -m2*Math.cos(2*x[0] - 2*x[1])))];
          }


           //            θ1' = ω1
//            θ2' = ω2
//            ω1' =  	 −g (2 m1 + m2) sin θ1 − m2 g sin(θ1 − 2 θ2) − 2 sin(θ1 − θ2) m2 (ω22 L2 + ω12 L1 cos(θ1 − θ2))
//            L1 (2 m1 + m2 − m2 cos(2 θ1 − 2 θ2))
//            ω2' =  	 2 sin(θ1−θ2) (ω12 L1 (m1 + m2) + g(m1 + m2) cos θ1 + ω22 L2 m2 cos(θ1 − θ2))
//            L2 (2 m1 + m2 − m2 cos(2 θ1 − 2 θ2))


                //Anything more than 3 iterations gets noticed, 1e-4 tolerance is about best can do
                //without ruining the feel of live simulation, see below for fix to avoid
                //energy buildup

                sol= numeric.dopri(x,x+0.1,[theta1,theta2,omega1,omega2],f,1e-4,3);

                theta1 = sol.y[1][0];
                theta2 = sol.y[1][1];
                omega1 = sol.y[1][2];
                omega2 = sol.y[1][3];

               //can't tax browser too much with numerics, so to avoid energy gain, max out omega1/omega2
               //an ugly solution, but user experience comes first here, and any other solution would ruin illusion of live run
               //obviously chaos-lab version will need to have better options
               //this version is more a proof-of-concept than an academic exercise
               if(omega1>15){omega1=8;}
               if(omega1<-15){omega1=-8;}
               if(omega2>30){omega2=20;}
               if(omega2<-30){omega2=-20;}

               // console.log(omega2);
                pend.j1x = pivot.x + Math.floor(Math.sin(theta1)*L1*100)+1;
                pend.j1y = pivot.y + Math.floor(Math.cos(theta1)*L1*100)+1;

                pend.j2x = pend.j1x + Math.floor(Math.sin(theta2)*L2*100)+1;
                pend.j2y = pend.j1y + Math.floor(Math.cos(theta2)*L2*100)+1;

              //  var u = m1*g*(L1*Math.cos(theta1))+0.5*m1*L1*omega1*L1*omega1 + m2*g*(L1*Math.cos(theta1)+L2*Math.cos(theta2)) +0.5*m2*(L2*omega2*L2*omega2 + L1*omega1*L1*omega1 + 2*omega1*L1*omega2*L2*Math.cos(theta1-theta2));
             //   console.log(u);
                terCtx.beginPath();
                terCtx.globalCompositeOperation='destination-over';
                terCtx.rect(pend.j2x, pend.j2y, 1, 1);
                terCtx.closePath();
                terCtx.fillStyle = "rgba(153,220,5,0.45)";
                terCtx.fill();

                  //CORE
                 context.beginPath();
                 context.globalCompositeOperation='destination-over';
                 context.arc(pivot.x,pivot.y,2,0, Math.PI*2, true);
                 context.fillStyle = "rgba(0,0,0,1)";
                 context.fill();
                 context.closePath();

                 //MID
                  context.beginPath();
                 context.globalCompositeOperation='destination-over';
                 context.arc(pend.j1x,pend.j1y,3,0, Math.PI*2, true);
                 context.fillStyle = "rgba(250,0,215,1)";
                 context.fill();
                 context.closePath();

                 //LAST
                  context.beginPath();
                 context.globalCompositeOperation='destination-over';
                 context.arc(pend.j2x,pend.j2y,3,0, Math.PI*2, true);
                 context.fillStyle = "rgba(250,0,215,0.9)";
                 context.fill();
                 context.closePath();

                 context.beginPath();
                 context.moveTo(pivot.x,pivot.y);
                 context.lineTo(pend.j1x,pend.j1y);
                 context.lineTo(pend.j2x,pend.j2y);
                 context.lineTo(pend.j1x,pend.j1y);
                 context.closePath();
                 context.stroke();
                 x = x + 0.1;
                // request new frame
                requestAnimFrame(function(){
                    animate(myRectangle,myStar,myPlanet,mousePos,pend);
                });

            }

    window.onload = function(){



      var myRectangle = {
          x: 700,
          y: 50,
          width: 1,
          height: 1

      };
      var myStar = {
           x: 100,
           y: 50,
           rad: 3,
           speedx: 0,
           speedy: 0

       };
      var myPlanet = {
          x:120,
          y:20,
          rad: 3,
          speedx: -1,
          speedy: -1
      };

      var mousePos ={x:400,y:30};
      var pend = { j1x: 230, j1y: 45, j1vx:0, j1vy:-1, j2x: 220, j2vx:0, j2y:65, j2vy:0};
      animate(myRectangle,myStar,myPlanet,mousePos,pend);
            };

        </script>
        <canvas id="terCanvas" widht="500" height="150" style="top:0; margin:-220px"></canvas>
        <canvas id="myCanvas" width="500" height="60" style="top:0; margin:-80px 0px 0px 0px;"></canvas>    <div id="main">
<h2><a href="http://doctimjones.org/bize-sized-stochastic-control-theory.html">Bize sized stochastic control theory</a></h2>
<h5><i class="icon-feather"></i> Tue 31 January 2017
<i class="icon-bookmarks"></i>
<span><a href="http://doctimjones.org/tag/control-theory.html">Control Theory</a> / </span>
<span><a href="http://doctimjones.org/tag/stochastic.html">Stochastic</a> / </span>
<span><a href="http://doctimjones.org/tag/python.html">Python</a> / </span>
</h5>

<p>WORK IN PROGRESS...</p>
<h3>Theory vs. on the ground</h3>
<p><em>Deterministic</em> and <em>stochastic</em> control theory both approach the same general problem of
preventing unwanted behaviors of a system by controlling input variables. The deterministic
variation assumes everything is known or at least knowable and predictable in such a way that
given a snapshot of a system, with the proper analysis and with the proper system (i.e. a
system which <em>can</em> be controlled, doesn't have catastrophe points) we can control it in
perpetuity. <strong>Stochastic</strong> control theory essentially expands control theory to deal with
systems which have real-world behavior-that is, systems which do not behave ideally and
are subject to random variations in behavior (though those variations are perturbations
to an otherwise systematic behavior). Here, we take a quick bite-sized look at an example.</p>
<h4>An example</h4>
<p>Take a look at the system defined by</p>
<div class="math">$$\frac{dx}{dt} = u$$</div>
<div class="math">$$x(0) = 1$$</div>
<p>where we seek to minimize the function</p>
<div class="math">$$J = \int^{\infty}_0 \left[ x^2(t) + u^2(t)\right] dt$$</div>
<p>.</p>
<h5>What does it correspond to?</h5>
<p>Firstly, it is important to understand that <span class="math">\(u\)</span> is not necessarily a constant. In fact, if <span class="math">\(J\)</span> is
somehow an expression of some idealized behavior, (e.g. minimize polution output), then choosing
<span class="math">\(u\)</span> to be a constant would be a very bad idea as <span class="math">\(J \rightarrow \infty\)</span>.</p>
<h5>Finding u</h5>
<p>So let's now try to find a <span class="math">\(u\)</span> that would minimize <span class="math">\(J\)</span>. First, re-write <span class="math">\(J\)</span> as</p>
<div class="math">$$J = \int^{\infty}_0 \left[ x^2(t) + u^2(t) \right] dt$$</div>
<p>and then we note that</p>
<div class="math">$$\int^{T}_0 \left[ x^2(t) + u^2(t) \right] dt = x^2(0) - x^2(T) + \int^{T}_0 \left[ x(t) + \dot{x}(t) \right]^2 dt$$</div>
<p>Let's find the minima of this with respect to <span class="math">\(d/d(\dot{x})\)</span>, setting the result to zero, to find that</p>
<div class="math">$$x(t) = - \dot{x}(t)$$</div>
<p>We can look at this as an open loop control, such that we solve to find that</p>
<div class="math">$$u(t) = -e^{-t}$$</div>
<p>and then somehow find a way to design the system to obey this function. Or we can treat it as a closed loop control
and use</p>
<div class="math">$$\dot{x}{t} = -x(t)$$</div>
<p>,</p>
<p>e.g. using a simple Eulerian integration for the sake of argument, the system can be best controlled by changing parameter <span class="math">\(x\)</span> at time <span class="math">\(t\)</span> as dictated by the relation:</p>
<div class="math">$$\delta x = -x(t) \delta t$$</div>
<p>.</p>
<h5>What is the difference?</h5>
<p>For a deterministic system, the exponent we found for <span class="math">\(u\)</span> seems like a great solution <strong>if</strong> it can be
designed into the system. But what happens if we have stochastic noise?</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' }, Macros: {} }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
     <li class="footer"><a href="http://doctimjones.org/tag/aws.html">AWS&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/chef.html">Chef&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/cloud-9-ide.html">Cloud 9 IDE&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/cloudformation.html">Cloudformation&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/control-theory.html">Control Theory&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/data-science.html">Data Science&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/devops.html">DevOps&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/docker.html">Docker&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/google-compute.html">Google Compute&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/jupyter.html">Jupyter&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/linux.html">Linux&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/math.html">Math&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/networking.html">Networking&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/pandas.html">Pandas&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/physics.html">Physics&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/python.html">Python&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/spark.html">Spark&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/ssh.html">SSH&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/stochastic.html">Stochastic&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="http://doctimjones.org/tag/thesis.html">Thesis</a></li>
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2017&nbsp;::</li>
    <li class="footer"><a href="http://doctimjones.org">doctimjones </a>&nbsp;::</li>
    <li class="footer">powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;::</li>
    <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div></body>
</html>